<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Effectful.Plugin</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.Plugin.html#plugin"><span class="hs-identifier">plugin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Traversable</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Class</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.InstEnv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">InstEnvs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lookupInstEnv</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PredType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.TyCo.Subst</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.TyCon</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tyConClass_maybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">splitAppTys</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.Unify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tcUnifyTy</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Driver.Config.Finder</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">initFinderOpts</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Driver.Env</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hsc_home_unit</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hsc_units</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Driver.Env.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HscEnv</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Driver.Plugins</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Plugin</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultPlugin</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">purePlugin</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Plugin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getTopEnv</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lookupOrig</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tcLookupClass</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tcPluginIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Solver.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newWantedEq</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runTcSEarlyAbort</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Types</span></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">TcPlugin</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TcPluginM</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TcPluginSolveResult</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeTcPluginTcM</span></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Ct</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CtEvidence</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CtLoc</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 908
</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">DictCt</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctPred</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">emptyRewriterSet</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EvBindsVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Role</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Utils.Env</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tcGetInstEnvs</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tcSplitTyConApp</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">eqType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">nonDetCmpType</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Types.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkTcOcc</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Types.Unique.FM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">emptyUFM</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Unit.Finder</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FindResult</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">findPluginModule</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Unit.Module</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Module</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ModuleName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkModuleName</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Utils.Outputable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Outputable</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">showSDocUnsafe</span></span><span class="hs-special">)</span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &gt;= 906
</span><span class="hs-keyword">type</span><span> </span><span id="TCvSubst"><span class="annot"><a href="Effectful.Plugin.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Subst</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-54"></span><span class="annot"><a href="Effectful.Plugin.html#plugin"><span class="hs-identifier hs-type">plugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plugin</span></span><span>
</span><span id="line-55"></span><span id="plugin"><span class="annot"><span class="annottext">plugin :: Plugin
</span><a href="Effectful.Plugin.html#plugin"><span class="hs-identifier hs-var hs-var">plugin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Plugin
</span><span class="hs-identifier hs-var">defaultPlugin</span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">tcPlugin</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[CommandLineOption]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcPlugin -&gt; Maybe TcPlugin
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPlugin</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcPluginInit :: TcPluginM (Class, IORef VisitedSet)
</span><a href="#local-6989586621679091435"><span class="hs-identifier hs-var">tcPluginInit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcPluginM (Class, IORef VisitedSet)
</span><a href="Effectful.Plugin.html#initPlugin"><span class="hs-identifier hs-var">initPlugin</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginRewrite :: (Class, IORef VisitedSet) -&gt; UniqFM TyCon TcPluginRewriter
</span><a href="#local-6989586621679091437"><span class="hs-identifier hs-var">tcPluginRewrite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">(Class, IORef VisitedSet)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqFM TyCon TcPluginRewriter
forall key elt. UniqFM key elt
</span><span class="hs-identifier hs-var">emptyUFM</span></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginSolve :: (Class, IORef VisitedSet) -&gt; TcPluginSolver
</span><a href="#local-6989586621679091438"><span class="hs-identifier hs-var">tcPluginSolve</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Class, IORef VisitedSet) -&gt; TcPluginSolver
</span><a href="Effectful.Plugin.html#solveFakedep"><span class="hs-identifier hs-var">solveFakedep</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginStop :: (Class, IORef VisitedSet) -&gt; TcPluginM ()
</span><a href="#local-6989586621679091440"><span class="hs-identifier hs-var">tcPluginStop</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">(Class, IORef VisitedSet)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcPluginM ()
forall a. a -&gt; TcPluginM a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">pluginRecompile</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">purePlugin</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="EffGiven"><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-var">EffGiven</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EffGiven"><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-var">EffGiven</span></a></span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="givenEffHead"><span class="annot"><span class="annottext">EffGiven -&gt; Type
</span><a href="Effectful.Plugin.html#givenEffHead"><span class="hs-identifier hs-var hs-var">givenEffHead</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="givenEff"><span class="annot"><span class="annottext">EffGiven -&gt; Type
</span><a href="Effectful.Plugin.html#givenEff"><span class="hs-identifier hs-var hs-var">givenEff</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="givenEs"><span class="annot"><span class="annottext">EffGiven -&gt; Type
</span><a href="Effectful.Plugin.html#givenEs"><span class="hs-identifier hs-var hs-var">givenEs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679091447"><span id="local-6989586621679091452"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-74"></span><span>  </span><span id="local-6989586621679091460"><span class="annot"><span class="annottext">show :: EffGiven -&gt; CommandLineOption
</span><a href="#local-6989586621679091460"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679091462"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091462"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679091463"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091463"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;[G] &quot;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; CommandLineOption
</span><span class="hs-identifier hs-var">showSDocUnsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091462"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot; :&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; CommandLineOption
</span><span class="hs-identifier hs-var">showSDocUnsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091463"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">data</span><span> </span><span id="EffWanted"><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-var">EffWanted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EffWanted"><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-var">EffWanted</span></a></span></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="wantedEffHead"><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEffHead"><span class="hs-identifier hs-var hs-var">wantedEffHead</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wantedEff"><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEff"><span class="hs-identifier hs-var hs-var">wantedEff</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wantedEs"><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEs"><span class="hs-identifier hs-var hs-var">wantedEs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="wantedLoc"><span class="annot"><span class="annottext">EffWanted -&gt; CtLoc
</span><a href="Effectful.Plugin.html#wantedLoc"><span class="hs-identifier hs-var hs-var">wantedLoc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtLoc</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679091471"><span id="local-6989586621679091476"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-type">EffWanted</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>  </span><span id="local-6989586621679091483"><span class="annot"><span class="annottext">show :: EffWanted -&gt; CommandLineOption
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-type">EffWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679091484"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091484"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679091485"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091485"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;[W] &quot;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; CommandLineOption
</span><span class="hs-identifier hs-var">showSDocUnsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091484"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot; :&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; CommandLineOption
</span><span class="hs-identifier hs-var">showSDocUnsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091485"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">newtype</span><span> </span><span id="OrdType"><span class="annot"><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-var">OrdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OrdType"><span class="annot"><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-var">OrdType</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unOrdType"><span class="annot"><span class="annottext">OrdType -&gt; Type
</span><a href="Effectful.Plugin.html#unOrdType"><span class="hs-identifier hs-var hs-var">unOrdType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679091490"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-type">OrdType</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621679091494"><span class="annot"><span class="annottext">== :: OrdType -&gt; OrdType -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(==)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><span class="hs-identifier hs-var">eqType</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool)
-&gt; (OrdType -&gt; Type) -&gt; OrdType -&gt; OrdType -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">OrdType -&gt; Type
</span><a href="Effectful.Plugin.html#unOrdType"><span class="hs-identifier hs-var">unOrdType</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679091500"><span id="local-6989586621679091503"><span id="local-6989586621679091506"><span id="local-6989586621679091509"><span id="local-6989586621679091512"><span id="local-6989586621679091515"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-type">OrdType</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679091518"><span class="annot"><span class="annottext">compare :: OrdType -&gt; OrdType -&gt; Ordering
</span><a href="#local-6989586621679091518"><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Ordering
</span><span class="hs-identifier hs-var">nonDetCmpType</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Ordering)
-&gt; (OrdType -&gt; Type) -&gt; OrdType -&gt; OrdType -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">OrdType -&gt; Type
</span><a href="Effectful.Plugin.html#unOrdType"><span class="hs-identifier hs-var">unOrdType</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">type</span><span> </span><span id="VisitedSet"><span class="annot"><a href="Effectful.Plugin.html#VisitedSet"><span class="hs-identifier hs-var">VisitedSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-type">OrdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-type">OrdType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="Effectful.Plugin.html#initPlugin"><span class="hs-identifier hs-type">initPlugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Class</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#VisitedSet"><span class="hs-identifier hs-type">VisitedSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="initPlugin"><span class="annot"><span class="annottext">initPlugin :: TcPluginM (Class, IORef VisitedSet)
</span><a href="Effectful.Plugin.html#initPlugin"><span class="hs-identifier hs-var hs-var">initPlugin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621679091520"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679091520"><span class="hs-identifier hs-var">recMod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; TcPluginM Module
</span><a href="#local-6989586621679091521"><span class="hs-identifier hs-var">lookupModule</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; TcPluginM Module) -&gt; ModuleName -&gt; TcPluginM Module
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; ModuleName
</span><span class="hs-identifier hs-var">mkModuleName</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Effectful.Internal.Effect&quot;</span></span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621679091522"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091522"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcPluginM Class
</span><span class="hs-identifier hs-var">tcLookupClass</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TcPluginM Class) -&gt; TcPluginM Name -&gt; TcPluginM Class
forall (m :: Type -&gt; Type) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; OccName -&gt; TcPluginM Name
</span><span class="hs-identifier hs-var">lookupOrig</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679091520"><span class="hs-identifier hs-var">recMod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; OccName
</span><span class="hs-identifier hs-var">mkTcOcc</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;:&gt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621679091524"><span class="annot"><span class="annottext">IORef VisitedSet
</span><a href="#local-6989586621679091524"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef VisitedSet) -&gt; TcPluginM (IORef VisitedSet)
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (IORef VisitedSet) -&gt; TcPluginM (IORef VisitedSet))
-&gt; IO (IORef VisitedSet) -&gt; TcPluginM (IORef VisitedSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VisitedSet -&gt; IO (IORef VisitedSet)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">VisitedSet
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><span class="annottext">(Class, IORef VisitedSet) -&gt; TcPluginM (Class, IORef VisitedSet)
forall a. a -&gt; TcPluginM a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091522"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef VisitedSet
</span><a href="#local-6989586621679091524"><span class="hs-identifier hs-var">visited</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="#local-6989586621679091521"><span class="hs-identifier hs-type">lookupModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ModuleName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Module</span></span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621679091521"><span class="annot"><span class="annottext">lookupModule :: ModuleName -&gt; TcPluginM Module
</span><a href="#local-6989586621679091521"><span class="hs-identifier hs-var hs-var">lookupModule</span></a></span></span><span> </span><span id="local-6989586621679091527"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621679091527"><span class="hs-identifier hs-var">mod_nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>      </span><span id="local-6989586621679091528"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621679091528"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcPluginM HscEnv
</span><span class="hs-identifier hs-var">getTopEnv</span></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091529"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621679091529"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><span class="hs-identifier hs-var">hsc_dflags</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621679091528"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-111"></span><span>          </span><span id="local-6989586621679091531"><span class="annot"><span class="annottext">fopts :: FinderOpts
</span><a href="#local-6989586621679091531"><span class="hs-identifier hs-var hs-var">fopts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; FinderOpts
</span><span class="hs-identifier hs-var">initFinderOpts</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679091529"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-112"></span><span>          </span><span id="local-6989586621679091532"><span class="annot"><span class="annottext">fc :: FinderCache
</span><a href="#local-6989586621679091532"><span class="hs-identifier hs-var hs-var">fc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; FinderCache
</span><span class="hs-identifier hs-var">hsc_FC</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621679091528"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-113"></span><span>          </span><span id="local-6989586621679091534"><span class="annot"><span class="annottext">units :: UnitState
</span><a href="#local-6989586621679091534"><span class="hs-identifier hs-var hs-var">units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><span class="hs-identifier hs-var">hsc_units</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621679091528"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-114"></span><span>          </span><span id="local-6989586621679091535"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621679091535"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><span class="hs-identifier hs-var">hsc_home_unit</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621679091528"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><span class="annottext">IO FindResult -&gt; TcPluginM FindResult
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinderCache
-&gt; FinderOpts
-&gt; UnitState
-&gt; Maybe HomeUnit
-&gt; ModuleName
-&gt; IO FindResult
</span><span class="hs-identifier hs-var">findPluginModule</span></span><span> </span><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621679091532"><span class="hs-identifier hs-var">fc</span></a></span><span> </span><span class="annot"><span class="annottext">FinderOpts
</span><a href="#local-6989586621679091531"><span class="hs-identifier hs-var">fopts</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621679091534"><span class="hs-identifier hs-var">units</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; Maybe HomeUnit
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621679091535"><span class="hs-identifier hs-var">home_unit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621679091527"><span class="hs-identifier hs-var">mod_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcPluginM FindResult
-&gt; (FindResult -&gt; TcPluginM Module) -&gt; TcPluginM Module
forall a b. TcPluginM a -&gt; (a -&gt; TcPluginM b) -&gt; TcPluginM b
forall (m :: Type -&gt; Type) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Found</span></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679091537"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679091537"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Module -&gt; TcPluginM Module
forall a. a -&gt; TcPluginM a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679091537"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-117"></span><span>        </span><span class="annot"><span class="annottext">FindResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; TcPluginM Module
forall a. CommandLineOption -&gt; a
</span><span class="hs-identifier hs-var">errorWithoutStackTrace</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Please add effectful-core to the list of dependencies.&quot;</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><a href="Effectful.Plugin.html#solveFakedep"><span class="hs-identifier hs-type">solveFakedep</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Class</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#VisitedSet"><span class="hs-identifier hs-type">VisitedSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvBindsVar</span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginSolveResult</span></span><span>
</span><span id="line-125"></span><span id="solveFakedep"><span class="annot"><span class="annottext">solveFakedep :: (Class, IORef VisitedSet) -&gt; TcPluginSolver
</span><a href="Effectful.Plugin.html#solveFakedep"><span class="hs-identifier hs-var hs-var">solveFakedep</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679091539"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091539"><span class="hs-identifier hs-var">elemCls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091540"><span class="annot"><span class="annottext">IORef VisitedSet
</span><a href="#local-6989586621679091540"><span class="hs-identifier hs-var">visitedRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679091541"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679091541"><span class="hs-identifier hs-var">allGivens</span></a></span></span><span> </span><span id="local-6989586621679091542"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679091542"><span class="hs-identifier hs-var">allWanteds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-comment">-- We're given two lists of constraints here:</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-comment">-- - 'allGivens' are constraints already in our context,</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-comment">-- - 'allWanteds' are constraints that need to be solved.</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-comment">-- In the following notes, the words &quot;give/given&quot; and &quot;want/wanted&quot; all refer</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-comment">-- to this specific technical concept: given constraints are those that we can</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-comment">-- use, and wanted constraints are those that we need to solve.</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-comment">--tcPluginIO $ do</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-comment">--  putStrLn $ &quot;Givens: &quot; &lt;&gt; show (showSDocUnsafe . ppr &lt;$&gt; allGivens)</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-comment">--  putStrLn $ &quot;Wanteds: &quot; &lt;&gt; show (showSDocUnsafe . ppr &lt;$&gt; allWanteds)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-comment">-- For each 'e :&gt; es' we /want/ to solve (the &quot;goal&quot;), we need to eventually</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-comment">-- correspond it to another unique /given/ 'e :&gt; es' that will make the</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-comment">-- program typecheck (the &quot;solution&quot;).</span><span>
</span><span id="line-143"></span><span>  </span><span id="local-6989586621679091543"><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621679091543"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs -&gt; TcPluginM InstEnvs
forall a. TcM a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">unsafeTcPluginTcM</span></span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><span class="hs-identifier hs-var">tcGetInstEnvs</span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091544"><span class="annot"><span class="annottext">solns :: [(EffWanted, EffGiven)]
</span><a href="#local-6989586621679091544"><span class="hs-identifier hs-var hs-var">solns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EffWanted -&gt; Maybe (EffWanted, EffGiven))
-&gt; [EffWanted] -&gt; [(EffWanted, EffGiven)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnvs -&gt; EffWanted -&gt; Maybe (EffWanted, EffGiven)
</span><a href="#local-6989586621679091546"><span class="hs-identifier hs-var">solve</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621679091543"><span class="hs-identifier hs-var">globals</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EffWanted]
</span><a href="#local-6989586621679091547"><span class="hs-identifier hs-var">effWanteds</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-comment">-- Now we need to tell GHC the solutions. The way we do this is to generate a</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-comment">-- new equality constraint, like 'State e ~ State Int', so that GHC's</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-comment">-- constraint solver will know that 'e' must be 'Int'.</span><span>
</span><span id="line-149"></span><span>  </span><span id="local-6989586621679091548"><span class="annot"><span class="annottext">[(Ct, (OrdType, OrdType))]
</span><a href="#local-6989586621679091548"><span class="hs-identifier hs-var">eqns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(EffWanted, EffGiven)]
-&gt; ((EffWanted, EffGiven) -&gt; TcPluginM (Ct, (OrdType, OrdType)))
-&gt; TcPluginM [(Ct, (OrdType, OrdType))]
forall (t :: Type -&gt; Type) (f :: Type -&gt; Type) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[(EffWanted, EffGiven)]
</span><a href="#local-6989586621679091544"><span class="hs-identifier hs-var">solns</span></a></span><span> </span><span class="annot"><span class="annottext">(((EffWanted, EffGiven) -&gt; TcPluginM (Ct, (OrdType, OrdType)))
 -&gt; TcPluginM [(Ct, (OrdType, OrdType))])
-&gt; ((EffWanted, EffGiven) -&gt; TcPluginM (Ct, (OrdType, OrdType)))
-&gt; TcPluginM [(Ct, (OrdType, OrdType))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679091550"><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091550"><span class="hs-identifier hs-var">goal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091551"><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091551"><span class="hs-identifier hs-var">soln</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091552"><span class="annot"><span class="annottext">wantedEq :: TcS (CtEvidence, Coercion)
</span><a href="#local-6989586621679091552"><span class="hs-identifier hs-var hs-var">wantedEq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet
-&gt; Role
-&gt; Type
-&gt; Type
-&gt; TcS (CtEvidence, Coercion)
</span><span class="hs-identifier hs-var">newWantedEq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffWanted -&gt; CtLoc
</span><a href="Effectful.Plugin.html#wantedLoc"><span class="hs-identifier hs-var">wantedLoc</span></a></span><span> </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091550"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><span class="hs-identifier hs-var">emptyRewriterSet</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier hs-var">Nominal</span></span><span>
</span><span id="line-151"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEff"><span class="hs-identifier hs-var">wantedEff</span></a></span><span> </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091550"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffGiven -&gt; Type
</span><a href="Effectful.Plugin.html#givenEff"><span class="hs-identifier hs-var">givenEff</span></a></span><span> </span><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091551"><span class="hs-identifier hs-var">soln</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679091554"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679091554"><span class="hs-identifier hs-var">eqn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (CtEvidence, Coercion) -&gt; TcPluginM (CtEvidence, Coercion)
forall a. TcM a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">unsafeTcPluginTcM</span></span><span> </span><span class="annot"><span class="annottext">(TcM (CtEvidence, Coercion) -&gt; TcPluginM (CtEvidence, Coercion))
-&gt; TcM (CtEvidence, Coercion) -&gt; TcPluginM (CtEvidence, Coercion)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcS (CtEvidence, Coercion) -&gt; TcM (CtEvidence, Coercion)
forall a. TcS a -&gt; TcM a
</span><span class="hs-identifier hs-var">runTcSEarlyAbort</span></span><span> </span><span class="annot"><span class="annottext">TcS (CtEvidence, Coercion)
</span><a href="#local-6989586621679091552"><span class="hs-identifier hs-var">wantedEq</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="annottext">(Ct, (OrdType, OrdType)) -&gt; TcPluginM (Ct, (OrdType, OrdType))
forall a. a -&gt; TcPluginM a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><span class="hs-identifier hs-var">CNonCanonical</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679091554"><span class="hs-identifier hs-var">eqn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; OrdType
</span><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-var">OrdType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; OrdType) -&gt; Type -&gt; OrdType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEff"><span class="hs-identifier hs-var">wantedEff</span></a></span><span> </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091550"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; OrdType
</span><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-var">OrdType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; OrdType) -&gt; Type -&gt; OrdType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EffGiven -&gt; Type
</span><a href="Effectful.Plugin.html#givenEff"><span class="hs-identifier hs-var">givenEff</span></a></span><span> </span><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091551"><span class="hs-identifier hs-var">soln</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-comment">-- For any solution we've generated, we need to be careful not to generate it</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-comment">-- again, or we might end up generating infinitely many solutions. So, we</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-comment">-- record any already generated solution in a set.</span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679091556"><span class="annot"><span class="annottext">VisitedSet
</span><a href="#local-6989586621679091556"><span class="hs-identifier hs-var">visitedSolnPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO VisitedSet -&gt; TcPluginM VisitedSet
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO VisitedSet -&gt; TcPluginM VisitedSet)
-&gt; IO VisitedSet -&gt; TcPluginM VisitedSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef VisitedSet -&gt; IO VisitedSet
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef VisitedSet
</span><a href="#local-6989586621679091540"><span class="hs-identifier hs-var">visitedRef</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091558"><span class="annot"><span class="annottext">solnEqns :: [Ct]
</span><a href="#local-6989586621679091558"><span class="hs-identifier hs-var hs-var">solnEqns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Ct, (OrdType, OrdType)) -&gt; Ct)
-&gt; [(Ct, (OrdType, OrdType))] -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Ct, (OrdType, OrdType)) -&gt; Ct
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(Ct, (OrdType, OrdType))] -&gt; [Ct])
-&gt; (((Ct, (OrdType, OrdType)) -&gt; Bool)
    -&gt; [(Ct, (OrdType, OrdType))])
-&gt; ((Ct, (OrdType, OrdType)) -&gt; Bool)
-&gt; [Ct]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(((Ct, (OrdType, OrdType)) -&gt; Bool)
 -&gt; [(Ct, (OrdType, OrdType))] -&gt; [(Ct, (OrdType, OrdType))])
-&gt; [(Ct, (OrdType, OrdType))]
-&gt; ((Ct, (OrdType, OrdType)) -&gt; Bool)
-&gt; [(Ct, (OrdType, OrdType))]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((Ct, (OrdType, OrdType)) -&gt; Bool)
-&gt; [(Ct, (OrdType, OrdType))] -&gt; [(Ct, (OrdType, OrdType))]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (OrdType, OrdType))]
</span><a href="#local-6989586621679091548"><span class="hs-identifier hs-var">eqns</span></a></span><span> </span><span class="annot"><span class="annottext">(((Ct, (OrdType, OrdType)) -&gt; Bool) -&gt; [Ct])
-&gt; ((Ct, (OrdType, OrdType)) -&gt; Bool) -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091562"><span class="annot"><span class="annottext">(OrdType, OrdType)
</span><a href="#local-6989586621679091562"><span class="hs-identifier hs-var">pair</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(OrdType, OrdType) -&gt; VisitedSet -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.notMember</span></span><span> </span><span class="annot"><span class="annottext">(OrdType, OrdType)
</span><a href="#local-6989586621679091562"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">VisitedSet
</span><a href="#local-6989586621679091556"><span class="hs-identifier hs-var">visitedSolnPairs</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; TcPluginM ()
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcPluginM ()) -&gt; IO () -&gt; TcPluginM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">IORef VisitedSet -&gt; (VisitedSet -&gt; VisitedSet) -&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef VisitedSet
</span><a href="#local-6989586621679091540"><span class="hs-identifier hs-var">visitedRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VisitedSet -&gt; VisitedSet -&gt; VisitedSet
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">(VisitedSet -&gt; VisitedSet -&gt; VisitedSet)
-&gt; VisitedSet -&gt; VisitedSet -&gt; VisitedSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(OrdType, OrdType)] -&gt; VisitedSet
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(OrdType, OrdType)] -&gt; VisitedSet)
-&gt; [(OrdType, OrdType)] -&gt; VisitedSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Ct, (OrdType, OrdType)) -&gt; (OrdType, OrdType))
-&gt; [(Ct, (OrdType, OrdType))] -&gt; [(OrdType, OrdType)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Ct, (OrdType, OrdType)) -&gt; (OrdType, OrdType)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (OrdType, OrdType))]
</span><a href="#local-6989586621679091548"><span class="hs-identifier hs-var">eqns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">--putStrLn $ &quot;Emitting: &quot; &lt;&gt; showSDocUnsafe (ppr solnEqns)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="annottext">TcPluginSolveResult -&gt; TcPluginM TcPluginSolveResult
forall a. a -&gt; TcPluginM a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TcPluginSolveResult -&gt; TcPluginM TcPluginSolveResult)
-&gt; TcPluginSolveResult -&gt; TcPluginM TcPluginSolveResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [(EvTerm, Ct)] -&gt; [Ct] -&gt; TcPluginSolveResult
</span><span class="hs-identifier hs-var">TcPluginSolveResult</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679091558"><span class="hs-identifier hs-var">solnEqns</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- The only type of constraint we're interested in solving are 'e :&gt; es'</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- constraints. Therefore, we extract these constraints out of the</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-comment">-- 'allGivens' and 'allWanted's.</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621679091569"><span class="annot"><span class="annottext">effGivens :: [EffGiven]
</span><a href="#local-6989586621679091569"><span class="hs-identifier hs-var hs-var">effGivens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Maybe EffGiven) -&gt; [Ct] -&gt; [EffGiven]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Maybe EffGiven
</span><a href="#local-6989586621679091570"><span class="hs-identifier hs-var">maybeEffGiven</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679091541"><span class="hs-identifier hs-var">allGivens</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679091571"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679091571"><span class="hs-identifier hs-var">otherWantedTys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091547"><span class="annot"><span class="annottext">[EffWanted]
</span><a href="#local-6989586621679091547"><span class="hs-identifier hs-var">effWanteds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either Type EffWanted] -&gt; ([Type], [EffWanted])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">([Either Type EffWanted] -&gt; ([Type], [EffWanted]))
-&gt; [Either Type EffWanted] -&gt; ([Type], [EffWanted])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Either Type EffWanted) -&gt; [Ct] -&gt; [Either Type EffWanted]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Either Type EffWanted
</span><a href="#local-6989586621679091573"><span class="hs-identifier hs-var">splitWanteds</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679091542"><span class="hs-identifier hs-var">allWanteds</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- We store a list of the types of all given constraints, which will be</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- useful later.</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621679091574"><span class="annot"><span class="annottext">allGivenTys :: [Type]
</span><a href="#local-6989586621679091574"><span class="hs-identifier hs-var hs-var">allGivenTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Type
</span><span class="hs-identifier hs-var">ctPred</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Type) -&gt; [Ct] -&gt; [Type]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679091541"><span class="hs-identifier hs-var">allGivens</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- Determine if there is a unique solution to a goal from a set of</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- candidates.</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="#local-6989586621679091546"><span class="hs-identifier hs-type">solve</span></a></span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InstEnvs</span></span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-type">EffWanted</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-type">EffWanted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679091546"><span class="annot"><span class="annottext">solve :: InstEnvs -&gt; EffWanted -&gt; Maybe (EffWanted, EffGiven)
</span><a href="#local-6989586621679091546"><span class="hs-identifier hs-var hs-var">solve</span></a></span></span><span> </span><span id="local-6989586621679091576"><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621679091576"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span id="local-6989586621679091577"><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091577"><span class="hs-identifier hs-var">goal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(EffGiven, TCvSubst)]
</span><a href="#local-6989586621679091578"><span class="hs-identifier hs-var">unifiableCands</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-183"></span><span>      </span><span class="hs-comment">-- If there's already only one unique solution, commit to it; in the worst</span><span>
</span><span id="line-184"></span><span>      </span><span class="hs-comment">-- case where it doesn't actually match, we get a cleaner error message</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-comment">-- like &quot;Unable to match (State String) to (State Int)&quot; instead of a type</span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-comment">-- ambiguity error.</span><span>
</span><span id="line-187"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679091579"><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091579"><span class="hs-identifier hs-var">soln</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EffWanted, EffGiven) -&gt; Maybe (EffWanted, EffGiven)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091577"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091579"><span class="hs-identifier hs-var">soln</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><span class="annottext">[(EffGiven, TCvSubst)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-comment">-- Otherwise, the second criteria comes in: the candidate must satisfy</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-comment">-- all other constraints we /want/ to solve. For example, when we want</span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-comment">-- to solve '(State a :&gt; es, Num a)`, the candidate 'State Int :&gt; es'</span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-comment">-- will do the job, because it satisfied 'Num a'; however 'State String</span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-comment">-- :&gt; es' will be excluded.</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091580"><span class="annot"><span class="annottext">satisfiableCands :: [(EffGiven, TCvSubst)]
</span><a href="#local-6989586621679091580"><span class="hs-identifier hs-var hs-var">satisfiableCands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EffGiven, TCvSubst) -&gt; Bool)
-&gt; [(EffGiven, TCvSubst)] -&gt; [(EffGiven, TCvSubst)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnvs -&gt; (EffGiven, TCvSubst) -&gt; Bool
</span><a href="#local-6989586621679091581"><span class="hs-identifier hs-var">satisfiable</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621679091576"><span class="hs-identifier hs-var">globals</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(EffGiven, TCvSubst)]
</span><a href="#local-6989586621679091578"><span class="hs-identifier hs-var">unifiableCands</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- Finally, if there is a unique candidate remaining, we use it as</span><span>
</span><span id="line-196"></span><span>           </span><span class="hs-comment">-- the solution; otherwise we don't solve anything.</span><span>
</span><span id="line-197"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(EffGiven, TCvSubst)]
</span><a href="#local-6989586621679091580"><span class="hs-identifier hs-var">satisfiableCands</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-198"></span><span>             </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679091582"><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091582"><span class="hs-identifier hs-var">soln</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EffWanted, EffGiven) -&gt; Maybe (EffWanted, EffGiven)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091577"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091582"><span class="hs-identifier hs-var">soln</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>             </span><span class="annot"><span class="annottext">[(EffGiven, TCvSubst)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EffWanted, EffGiven)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-comment">-- Apart from ':&gt;' constraints in the context, the effects already</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-comment">-- hardwired into the effect stack type, like those in 'A : B : C : es'</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-comment">-- also need to be considered. So here we extract that for them to be</span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-comment">-- considered simultaneously with regular ':&gt;' constraints.</span><span>
</span><span id="line-205"></span><span>        </span><span id="local-6989586621679091583"><span class="annot"><span class="annottext">cands :: [EffGiven]
</span><a href="#local-6989586621679091583"><span class="hs-identifier hs-var hs-var">cands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; [EffGiven]
</span><a href="#local-6989586621679091584"><span class="hs-identifier hs-var">extractExtraGivens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEs"><span class="hs-identifier hs-var">wantedEs</span></a></span><span> </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091577"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEs"><span class="hs-identifier hs-var">wantedEs</span></a></span><span> </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091577"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EffGiven] -&gt; [EffGiven] -&gt; [EffGiven]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[EffGiven]
</span><a href="#local-6989586621679091569"><span class="hs-identifier hs-var">effGivens</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-comment">-- The first criteria is that the candidate constraint must /unify/ with</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-comment">-- the goal. This means that the type variables in the goal can be</span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-comment">-- instantiated in a way so that the goal becomes equal to the</span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-comment">-- candidate. For example, the candidates 'State Int :&gt; es' and 'State</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-comment">-- String :&gt; es' both unify with the goal 'State s :&gt; es'.</span><span>
</span><span id="line-211"></span><span>        </span><span id="local-6989586621679091578"><span class="annot"><span class="annottext">unifiableCands :: [(EffGiven, TCvSubst)]
</span><a href="#local-6989586621679091578"><span class="hs-identifier hs-var hs-var">unifiableCands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EffGiven -&gt; Maybe (EffGiven, TCvSubst))
-&gt; [EffGiven] -&gt; [(EffGiven, TCvSubst)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffWanted -&gt; EffGiven -&gt; Maybe (EffGiven, TCvSubst)
</span><a href="#local-6989586621679091585"><span class="hs-identifier hs-var">unifiableWith</span></a></span><span> </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091577"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EffGiven]
</span><a href="#local-6989586621679091583"><span class="hs-identifier hs-var">cands</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-comment">-- Extract the heads of a type like 'A : B : C : es' into 'FakedepGiven's.</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><a href="#local-6989586621679091584"><span class="hs-identifier hs-type">extractExtraGivens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679091584"><span class="annot"><span class="annottext">extractExtraGivens :: Type -&gt; Type -&gt; [EffGiven]
</span><a href="#local-6989586621679091584"><span class="hs-identifier hs-var hs-var">extractExtraGivens</span></a></span></span><span> </span><span id="local-6989586621679091586"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091586"><span class="hs-identifier hs-var">fullEs</span></a></span></span><span> </span><span id="local-6989586621679091587"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091587"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, [Type])
</span><span class="hs-identifier hs-var">splitAppTys</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091587"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679091588"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091588"><span class="hs-identifier hs-var">_colon</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679091589"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091589"><span class="hs-identifier hs-var">_kind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091590"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091590"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091591"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091591"><span class="hs-identifier hs-var">es'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679091592"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091592"><span class="hs-identifier hs-var">dtHead</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091593"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679091593"><span class="hs-identifier hs-var">_tyArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, [Type])
</span><span class="hs-identifier hs-var">splitAppTys</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091590"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">givenEffHead :: Type
</span><a href="Effectful.Plugin.html#givenEffHead"><span class="hs-identifier hs-var">givenEffHead</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091592"><span class="hs-identifier hs-var">dtHead</span></a></span><span>
</span><span id="line-219"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">givenEff :: Type
</span><a href="Effectful.Plugin.html#givenEff"><span class="hs-identifier hs-var">givenEff</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091590"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-220"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">givenEs :: Type
</span><a href="Effectful.Plugin.html#givenEs"><span class="hs-identifier hs-var">givenEs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091586"><span class="hs-identifier hs-var">fullEs</span></a></span><span>
</span><span id="line-221"></span><span>                    </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">EffGiven -&gt; [EffGiven] -&gt; [EffGiven]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; [EffGiven]
</span><a href="#local-6989586621679091584"><span class="hs-identifier hs-var">extractExtraGivens</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091586"><span class="hs-identifier hs-var">fullEs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091591"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="annottext">(Type, [Type])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-comment">-- Determine whether a given constraint is of form 'e :&gt; es'.</span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="#local-6989586621679091570"><span class="hs-identifier hs-type">maybeEffGiven</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621679091570"><span class="annot"><span class="annottext">maybeEffGiven :: Ct -&gt; Maybe EffGiven
</span><a href="#local-6989586621679091570"><span class="hs-identifier hs-var hs-var">maybeEffGiven</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 908
</span><span>      </span><span class="annot"><span class="hs-identifier hs-type">CDictCan</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><span class="hs-identifier hs-var">cc_class</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679091596"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091596"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-229"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><span class="hs-identifier hs-var">cc_tyargs</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679091598"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091598"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091599"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091599"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>               </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-cpp">
#else
</span><span>      </span><span class="hs-identifier">CDictCan</span><span> </span><span class="hs-identifier">DictCt</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">di_cls</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cls</span><span>
</span><span id="line-233"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">di_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">eff</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">es</span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span>                      </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-cpp">
#endif
</span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091596"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Class -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091539"><span class="hs-identifier hs-var">elemCls</span></a></span><span>
</span><span id="line-237"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">EffGiven -&gt; Maybe EffGiven
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">givenEffHead :: Type
</span><a href="Effectful.Plugin.html#givenEffHead"><span class="hs-identifier hs-var">givenEffHead</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, [Type]) -&gt; Type
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Type, [Type]) -&gt; Type) -&gt; (Type, [Type]) -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, [Type])
</span><span class="hs-identifier hs-var">splitAppTys</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091598"><span class="hs-identifier hs-var">eff</span></a></span><span>
</span><span id="line-238"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">givenEff :: Type
</span><a href="Effectful.Plugin.html#givenEff"><span class="hs-identifier hs-var">givenEff</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091598"><span class="hs-identifier hs-var">eff</span></a></span><span>
</span><span id="line-239"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">givenEs :: Type
</span><a href="Effectful.Plugin.html#givenEs"><span class="hs-identifier hs-var">givenEs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091599"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-240"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe EffGiven
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe EffGiven
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-comment">-- Determine whether a wanted constraint is of form 'e :&gt; es'.</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="#local-6989586621679091573"><span class="hs-identifier hs-type">splitWanteds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-type">EffWanted</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621679091573"><span class="annot"><span class="annottext">splitWanteds :: Ct -&gt; Either Type EffWanted
</span><a href="#local-6989586621679091573"><span class="hs-identifier hs-var hs-var">splitWanteds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 908
</span><span>      </span><span id="local-6989586621679091600"><span class="annot"><span class="annottext">ct :: Ct
</span><a href="#local-6989586621679091600"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CDictCan</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">cc_ev</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtWanted</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctev_loc</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679091604"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679091604"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-249"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><span class="hs-identifier hs-var">cc_class</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679091605"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091605"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-250"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><span class="hs-identifier hs-var">cc_tyargs</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679091606"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091606"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091607"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091607"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span>               </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-cpp">
#else
</span><span>      </span><span class="hs-identifier">ct</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">CDictCan</span><span> </span><span class="hs-identifier">DictCt</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">di_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CtWanted</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-254"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">di_cls</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cls</span><span>
</span><span id="line-255"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">di_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">eff</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">es</span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span>                          </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-cpp">
#endif
</span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091605"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Class -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091539"><span class="hs-identifier hs-var">elemCls</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">EffWanted -&gt; Either Type EffWanted
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-type">EffWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wantedEffHead :: Type
</span><a href="Effectful.Plugin.html#wantedEffHead"><span class="hs-identifier hs-var">wantedEffHead</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, [Type]) -&gt; Type
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Type, [Type]) -&gt; Type) -&gt; (Type, [Type]) -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, [Type])
</span><span class="hs-identifier hs-var">splitAppTys</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091606"><span class="hs-identifier hs-var">eff</span></a></span><span>
</span><span id="line-260"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wantedEff :: Type
</span><a href="Effectful.Plugin.html#wantedEff"><span class="hs-identifier hs-var">wantedEff</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091606"><span class="hs-identifier hs-var">eff</span></a></span><span>
</span><span id="line-261"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wantedEs :: Type
</span><a href="Effectful.Plugin.html#wantedEs"><span class="hs-identifier hs-var">wantedEs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091607"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-262"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wantedLoc :: CtLoc
</span><a href="Effectful.Plugin.html#wantedLoc"><span class="hs-identifier hs-var">wantedLoc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679091604"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-263"></span><span>                             </span><span class="hs-special">}</span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either Type EffWanted
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Either Type EffWanted) -&gt; Type -&gt; Either Type EffWanted
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Type
</span><span class="hs-identifier hs-var">ctPred</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679091600"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span id="local-6989586621679091608"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679091608"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either Type EffWanted
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Either Type EffWanted) -&gt; Type -&gt; Either Type EffWanted
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Type
</span><span class="hs-identifier hs-var">ctPred</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679091608"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- Given a wanted constraint and a given constraint, unify them and give</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- back a substitution that can be applied to the wanted to make it equal to</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">-- the given.</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><a href="#local-6989586621679091585"><span class="hs-identifier hs-type">unifiableWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffWanted"><span class="hs-identifier hs-type">EffWanted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Effectful.Plugin.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621679091585"><span class="annot"><span class="annottext">unifiableWith :: EffWanted -&gt; EffGiven -&gt; Maybe (EffGiven, TCvSubst)
</span><a href="#local-6989586621679091585"><span class="hs-identifier hs-var hs-var">unifiableWith</span></a></span></span><span> </span><span id="local-6989586621679091609"><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091609"><span class="hs-identifier hs-var">goal</span></a></span></span><span> </span><span id="local-6989586621679091610"><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091610"><span class="hs-identifier hs-var">cand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-keyword">if</span><span>    </span><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEs"><span class="hs-identifier hs-var">wantedEs</span></a></span><span>      </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091609"><span class="hs-identifier hs-var">goal</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><span class="hs-operator hs-var">`eqType`</span></span><span> </span><span class="annot"><span class="annottext">EffGiven -&gt; Type
</span><a href="Effectful.Plugin.html#givenEs"><span class="hs-identifier hs-var">givenEs</span></a></span><span>      </span><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091610"><span class="hs-identifier hs-var">cand</span></a></span><span>
</span><span id="line-273"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEffHead"><span class="hs-identifier hs-var">wantedEffHead</span></a></span><span> </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091609"><span class="hs-identifier hs-var">goal</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><span class="hs-operator hs-var">`eqType`</span></span><span> </span><span class="annot"><span class="annottext">EffGiven -&gt; Type
</span><a href="Effectful.Plugin.html#givenEffHead"><span class="hs-identifier hs-var">givenEffHead</span></a></span><span> </span><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091610"><span class="hs-identifier hs-var">cand</span></a></span><span>
</span><span id="line-274"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091610"><span class="hs-identifier hs-var">cand</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCvSubst -&gt; (EffGiven, TCvSubst))
-&gt; Maybe TCvSubst -&gt; Maybe (EffGiven, TCvSubst)
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Maybe TCvSubst
</span><span class="hs-identifier hs-var">tcUnifyTy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffWanted -&gt; Type
</span><a href="Effectful.Plugin.html#wantedEff"><span class="hs-identifier hs-var">wantedEff</span></a></span><span> </span><span class="annot"><span class="annottext">EffWanted
</span><a href="#local-6989586621679091609"><span class="hs-identifier hs-var">goal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffGiven -&gt; Type
</span><a href="Effectful.Plugin.html#givenEff"><span class="hs-identifier hs-var">givenEff</span></a></span><span> </span><span class="annot"><span class="annottext">EffGiven
</span><a href="#local-6989586621679091610"><span class="hs-identifier hs-var">cand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (EffGiven, TCvSubst)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-comment">-- Check whether a candidate can satisfy all the wanted constraints.</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="#local-6989586621679091581"><span class="hs-identifier hs-type">satisfiable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InstEnvs</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.Plugin.html#EffGiven"><span class="hs-identifier hs-type">EffGiven</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Effectful.Plugin.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621679091581"><span class="annot"><span class="annottext">satisfiable :: InstEnvs -&gt; (EffGiven, TCvSubst) -&gt; Bool
</span><a href="#local-6989586621679091581"><span class="hs-identifier hs-var hs-var">satisfiable</span></a></span></span><span> </span><span id="local-6989586621679091612"><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621679091612"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EffGiven
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091613"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621679091613"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Type -&gt; Bool) -&gt; [Type] -&gt; Bool)
-&gt; [Type] -&gt; (Type -&gt; Bool) -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; [Type] -&gt; Bool
forall (t :: Type -&gt; Type) a.
Foldable t =&gt;
(a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679091615"><span class="hs-identifier hs-var">wantedsInst</span></a></span><span> </span><span class="annot"><span class="annottext">((Type -&gt; Bool) -&gt; Bool) -&gt; (Type -&gt; Bool) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679091616"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091616"><span class="hs-identifier hs-var">wanted</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-280"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">OrdType -&gt; Set OrdType -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; OrdType
</span><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-var">OrdType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091616"><span class="hs-identifier hs-var">wanted</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set OrdType
</span><a href="#local-6989586621679091618"><span class="hs-identifier hs-var">givensInst</span></a></span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Can we find this constraint in our local context?</span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (TyCon, [Type])
</span><span class="hs-identifier hs-var">tcSplitTyConApp</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679091616"><span class="hs-identifier hs-var">wanted</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-283"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679091619"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679091619"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091620"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679091620"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>            </span><span class="hs-comment">-- If not, lookup the global environment.</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><span class="hs-identifier hs-var">tyConClass_maybe</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679091619"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>              </span><span class="annot"><span class="annottext">Maybe Class
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-287"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679091621"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091621"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-288"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679091622"><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621679091622"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PotentialUnifiers
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; InstEnvs
-&gt; Class
-&gt; [Type]
-&gt; ([InstMatch], PotentialUnifiers, [InstMatch])
</span><span class="hs-identifier hs-var">lookupInstEnv</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621679091612"><span class="hs-identifier hs-var">globals</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679091621"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679091620"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-289"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InstMatch] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: Type -&gt; Type) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621679091622"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-comment">-- The wanteds after unification.</span><span>
</span><span id="line-292"></span><span>        </span><span id="local-6989586621679091615"><span class="annot"><span class="annottext">wantedsInst :: [Type]
</span><a href="#local-6989586621679091615"><span class="hs-identifier hs-var hs-var">wantedsInst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TCvSubst -&gt; [Type] -&gt; [Type]
TCvSubst -&gt; [Type] -&gt; [Type]
</span><span class="hs-identifier hs-var">substTys</span></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621679091613"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679091571"><span class="hs-identifier hs-var">otherWantedTys</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-comment">-- The local given context after unification.</span><span>
</span><span id="line-294"></span><span>        </span><span id="local-6989586621679091618"><span class="annot"><span class="annottext">givensInst :: Set OrdType
</span><a href="#local-6989586621679091618"><span class="hs-identifier hs-var hs-var">givensInst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OrdType] -&gt; Set OrdType
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; OrdType
</span><a href="Effectful.Plugin.html#OrdType"><span class="hs-identifier hs-var">OrdType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; OrdType) -&gt; [Type] -&gt; [OrdType]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TCvSubst -&gt; [Type] -&gt; [Type]
TCvSubst -&gt; [Type] -&gt; [Type]
</span><span class="hs-identifier hs-var">substTys</span></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621679091613"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679091574"><span class="hs-identifier hs-var">allGivenTys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span></pre></body></html>