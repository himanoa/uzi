<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Effectful.Dispatch.Dynamic</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">effectful-core-2.3.0.1: An easy to use, performant extensible effects library.</span><ul class="links" id="page-menu"><li><a href="src/Effectful.Dispatch.Dynamic.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Effectful.Dispatch.Dynamic</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Introduction</a><ul><li><a href="#g:2">An example</a></li><li><a href="#g:3">First order and higher order effects</a></li><li><a href="#g:4">Integration with <code>mtl</code> style effects</a><ul><li><a href="#g:5">Functional dependencies</a></li></ul></li></ul></li><li><a href="#g:6">Sending operations to the handler</a></li><li><a href="#g:7">Handling effects</a><ul><li><a href="#g:8">Handling local <code>Eff</code> computations</a><ul><li><a href="#g:9">Unlifts</a></li><li><a href="#g:10">Lifts</a></li><li><a href="#g:11">Bidirectional lifts</a></li><li><a href="#g:12">Utils</a></li></ul></li></ul></li><li><a href="#g:13">Re-exports</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Dynamically dispatched effects.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:send">send</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a>, e <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es) =&gt; e (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es) a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><span class="keyword">type</span> <a href="#t:EffectHandler">EffectHandler</a> e es = <span class="keyword">forall</span> a localEs. (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, e <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> localEs) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs es -&gt; e (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs) a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:interpret">interpret</a> :: <a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a> =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a> e es -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> (e : es) a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:reinterpret">reinterpret</a> :: <a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a> =&gt; (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> handlerEs a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b) -&gt; <a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a> e handlerEs -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> (e : es) a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b</li><li class="src short"><a href="#v:interpose">interpose</a> :: <span class="keyword">forall</span> e es a. (<a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a>, e <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a> e es -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:impose">impose</a> :: <span class="keyword">forall</span> e es handlerEs a b. (<a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a>, e <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es) =&gt; (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> handlerEs a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b) -&gt; <a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a> e handlerEs -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b</li><li class="src short"><span class="keyword">data</span> <a href="#t:LocalEnv">LocalEnv</a> (localEs :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>]) (handlerEs :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>])</li><li class="src short"><a href="#v:localSeqUnlift">localSeqUnlift</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:localSeqUnliftIO">localSeqUnliftIO</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs, <a href="Effectful.html#t:IOE" title="Effectful">IOE</a> <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:localUnlift">localUnlift</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a> -&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:localUnliftIO">localUnliftIO</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs, <a href="Effectful.html#t:IOE" title="Effectful">IOE</a> <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a> -&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:localSeqLift">localSeqLift</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:localLift">localLift</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a> -&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:withLiftMap">withLiftMap</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; ((<span class="keyword">forall</span> a b. (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs b) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r</li><li class="src short"><a href="#v:withLiftMapIO">withLiftMapIO</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs, <a href="Effectful.html#t:IOE" title="Effectful">IOE</a> <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; ((<span class="keyword">forall</span> a b. (<a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs b) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r</li><li class="src short"><a href="#v:localLiftUnlift">localLiftUnlift</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a> -&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r) -&gt; (<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><a href="#v:localLiftUnliftIO">localLiftUnliftIO</a> :: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs, <a href="Effectful.html#t:IOE" title="Effectful">IOE</a> <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs -&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a> -&gt; ((<span class="keyword">forall</span> r. <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r) -&gt; (<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</li><li class="src short"><span class="keyword">class</span> <a href="#t:SharedSuffix">SharedSuffix</a> (es1 :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>]) (es2 :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>])</li><li class="src short"><span class="keyword">type</span> <a href="#t:HasCallStack">HasCallStack</a> = ?callStack :: <a href="Effectful-Error-Static.html#t:CallStack" title="Effectful.Error.Static">CallStack</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Introduction</h1></a><div class="doc"><p>A dynamically dispatched effect is a collection of operations that can be
 interpreted in different ways at runtime, depending on the handler that is
 used to run the effect.</p><p>This allows a programmer to separate the <strong>what</strong> from the <strong>how</strong>,
 i.e. define effects that model what the code should do, while providing
 handlers that determine how it should do it later. Moreover, different
 environments can use different handlers to change the behavior of specific
 parts of the application if appropriate.</p></div><a href="#g:2" id="g:2"><h2>An example</h2></a><div class="doc"><p>Let's create an effect for basic file access, i.e. writing and reading files.</p><p>First, we need to define a generalized algebraic data type of kind <code><a href="Effectful.html#t:Effect" title="Effectful">Effect</a></code>,
 where each constructor corresponds to a specific operation of the effect in
 question.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  data FileSystem :: Effect where
    ReadFile  :: FilePath -&gt; FileSystem m String
    WriteFile :: FilePath -&gt; String -&gt; FileSystem m ()
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>type instance DispatchOf FileSystem = Dynamic
</code></strong></pre><p>The <code>FileSystem</code> effect has two operations:</p><ul><li><code>ReadFile</code>, which takes a <code>FilePath</code> and returns a <code>String</code> in the monadic
   context.</li><li><code>WriteFile</code>, which takes a <code>FilePath</code>, a <code>String</code> and returns a <code>()</code> in the
   monadic context.</li></ul><p>For people familiar with <code>mtl</code> style effects, note that the syntax looks very
 similar to defining an appropriate type class:</p><pre>class FileSystem m where
  readFile  :: FilePath -&gt; m String
  writeFile :: FilePath -&gt; String -&gt; m ()
</pre><p>The biggest difference between these two is that the definition of a type
 class gives us operations as functions, while the definition of an effect
 gives us operations as data constructors. They can be turned into functions
 with the help of <code><a href="Effectful-Dispatch-Dynamic.html#v:send" title="Effectful.Dispatch.Dynamic">send</a></code>:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  readFile :: (HasCallStack, FileSystem :&gt; es) =&gt; FilePath -&gt; Eff es String
  readFile path = send (ReadFile path)
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  writeFile :: (HasCallStack, FileSystem :&gt; es) =&gt; FilePath -&gt; String -&gt; Eff es ()
  writeFile path content = send (WriteFile path content)
:}
</pre><p><em>Note:</em> the above functions and the <code><a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a></code> instance can also be
 automatically generated by the
 <a href="https://hackage.haskell.org/package/effectful-th/docs/Effectful-TH.html#v:makeEffect"><code>makeEffect</code></a>
 function from the
 <a href="https://hackage.haskell.org/package/effectful-th">effectful-th</a> package.</p><p>The following defines an <code><a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a></code> that reads and writes files from the
 drive:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Control.Exception (IOException)
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Control.Monad.Catch (catch)
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import qualified System.IO as IO
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Effectful.Error.Static
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>newtype FsError = FsError String deriving Show
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> runFileSystemIO
   :: (IOE :&gt; es, Error FsError :&gt; es)
   =&gt; Eff (FileSystem : es) a
   -&gt; Eff es a
 runFileSystemIO = interpret $ \_ -&gt; \case
   ReadFile path           -&gt; adapt $ IO.readFile path
   WriteFile path contents -&gt; adapt $ IO.writeFile path contents
   where
     adapt m = liftIO m `catch` \(e::IOException) -&gt; throwError . FsError $ show e
:}
</pre><p>Here, we use <code><a href="Effectful-Dispatch-Dynamic.html#v:interpret" title="Effectful.Dispatch.Dynamic">interpret</a></code> and simply execute corresponding <code><a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a></code> actions for
 each operation, additionally doing a bit of error management.</p><p>On the other hand, maybe there is a situation in which instead of interacting
 with the outside world, a pure, in-memory storage is preferred:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import qualified Data.Map.Strict as M
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Effectful.State.Static.Local
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  runFileSystemPure
    :: Error FsError :&gt; es
    =&gt; M.Map FilePath String
    -&gt; Eff (FileSystem : es) a
    -&gt; Eff es a
  runFileSystemPure fs0 = reinterpret (evalState fs0) $ \_ -&gt; \case
    ReadFile path -&gt; gets (M.lookup path) &gt;&gt;= \case
      Just contents -&gt; pure contents
      Nothing       -&gt; throwError . FsError $ &quot;File not found: &quot; ++ show path
    WriteFile path contents -&gt; modify $ M.insert path contents
:}
</pre><p>Here, we use <code><a href="Effectful-Dispatch-Dynamic.html#v:reinterpret" title="Effectful.Dispatch.Dynamic">reinterpret</a></code> and introduce a
 <code><a href="Effectful-State-Static-Local.html#t:State" title="Effectful.State.Static.Local">State</a></code> effect for the storage that is private
 to the effect handler and cannot be accessed outside of it.</p><p>Let's compare how these differ.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  action = do
    file &lt;- readFile &quot;effectful-core.cabal&quot;
    pure $ length file &gt; 0
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:t action
</code></strong>action :: (FileSystem :&gt; es) =&gt; Eff es Bool
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runEff . runError @FsError . runFileSystemIO $ action
</code></strong>Right True
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runPureEff . runErrorNoCallStack @FsError . runFileSystemPure M.empty $ action
</code></strong>Left (FsError &quot;File not found: \&quot;effectful-core.cabal\&quot;&quot;)
</pre></div><a href="#g:3" id="g:3"><h2>First order and higher order effects</h2></a><div class="doc"><p>Note that the definition of the <code>FileSystem</code> effect from the previous section
 doesn't use the <code>m</code> type parameter. What is more, when the effect is
 interpreted, the <code><a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a></code> argument of the <code><a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a></code> is also not
 used. Such effects are <em>first order</em>.</p><p>If an effect makes use of the <code>m</code> parameter, it is a <em>higher order effect</em>.</p><p>Interpretation of higher order effects is slightly more involving. To see
 why, let's consider the <code>Profiling</code> effect for logging how much time a
 specific action took to run:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  data Profiling :: Effect where
    Profile :: String -&gt; m a -&gt; Profiling m a
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>type instance DispatchOf Profiling = Dynamic
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  profile :: (HasCallStack, Profiling :&gt; es) =&gt; String -&gt; Eff es a -&gt; Eff es a
  profile label action = send (Profile label action)
:}
</pre><p>If we naively try to interpret it, we will run into trouble:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import GHC.Clock (getMonotonicTime)
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> runProfiling :: IOE :&gt; es =&gt; Eff (Profiling : es) a -&gt; Eff es a
 runProfiling = interpret $ \_ -&gt; \case
   Profile label action -&gt; do
     t1 &lt;- liftIO getMonotonicTime
     r &lt;- action
     t2 &lt;- liftIO getMonotonicTime
     liftIO . putStrLn $ &quot;Action '&quot; ++ label ++ &quot;' took &quot; ++ show (t2 - t1) ++ &quot; seconds.&quot;
     pure r
:}
...
... Couldn't match type &#8216;localEs&#8217; with &#8216;es&#8217;
...
</pre><p>The problem is that <code>action</code> has a type <code>Eff localEs a</code>, while the monad of
 the effect handler is <code>Eff es</code>. <code>localEs</code> represents the <em>local environment</em>
 in which the <code>Profile</code> operation was called, which is opaque as the effect
 handler cannot possibly know how it looks like.</p><p>The solution is to use the <code><a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a></code> that an <code><a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a></code> is given to run
 the action using one of the functions from the <code><a href="Effectful-Dispatch-Dynamic.html#v:localUnlift" title="Effectful.Dispatch.Dynamic">localUnlift</a></code> family:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> runProfiling :: IOE :&gt; es =&gt; Eff (Profiling : es) a -&gt; Eff es a
 runProfiling = interpret $ \env -&gt; \case
   Profile label action -&gt; localSeqUnliftIO env $ \unlift -&gt; do
     t1 &lt;- getMonotonicTime
     r &lt;- unlift action
     t2 &lt;- getMonotonicTime
     putStrLn $ &quot;Action '&quot; ++ label ++ &quot;' took &quot; ++ show (t2 - t1) ++ &quot; seconds.&quot;
     pure r
:}
</pre><p>In a similar way we can define a dummy interpreter that does no profiling:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> runNoProfiling :: Eff (Profiling : es) a -&gt; Eff es a
 runNoProfiling = interpret $ \env -&gt; \case
   Profile label action -&gt; localSeqUnlift env $ \unlift -&gt; unlift action
:}
</pre><p>...and it's done.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>action = profile &quot;greet&quot; . liftIO $ putStrLn &quot;Hello!&quot;
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:t action
</code></strong>action :: (Profiling :&gt; es, IOE :&gt; es) =&gt; Eff es ()
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runEff . runProfiling $ action
</code></strong>Hello!
Action 'greet' took ... seconds.
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runEff . runNoProfiling $ action
</code></strong>Hello!
</pre></div><a href="#g:4" id="g:4"><h2>Integration with <code>mtl</code> style effects</h2></a><div class="doc"><p><a id="integration"></a></p><p>There exists a lot of libraries that provide their functionality as an <code>mtl</code>
 style effect, which generally speaking is a type class that contains core
 operations of the library in question.</p><p>Such effects are quite easy to use with the <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> monad. As an example,
 consider the <code>mtl</code> style effect for generation of random numbers:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  class Monad m =&gt; MonadRNG m where
    randomInt :: m Int
:}
</pre><p>Let's say the library also defines a helper function for generation of random
 strings:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Control.Monad
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Data.Char
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> randomString :: MonadRNG m =&gt; Int -&gt; m String
 randomString n = map chr &lt;$&gt; replicateM n randomInt
:}
</pre><p>To make it possible to use it with the <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> monad, the first step is to
 create an effect with operations that mirror the ones of a type class:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  data RNG :: Effect where
    RandomInt :: RNG m Int
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>type instance DispatchOf RNG = Dynamic
</code></strong></pre><p>If we continued as in the example above, we'd now create top level helper
 functions that execute effect operations using <code><a href="Effectful-Dispatch-Dynamic.html#v:send" title="Effectful.Dispatch.Dynamic">send</a></code>, in this case
 <code>randomInt</code> tied to <code>RandomInt</code>. But this function is already declared by the
 <code>MonadRNG</code> type class! Therefore, what we do instead is provide an
 <strong>orphan</strong>, <strong>canonical</strong> instance of <code>MonadRNG</code> for <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> that delegates to
 the <code>RNG</code> effect:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XUndecidableInstances
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  instance RNG :&gt; es =&gt; MonadRNG (Eff es) where
    randomInt = send RandomInt
:}
</pre><p>Now we only need an interpreter:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  runDummyRNG :: Eff (RNG : es) a -&gt; Eff es a
  runDummyRNG = interpret $ \_ -&gt; \case
    RandomInt -&gt; pure 55
:}
</pre><p>and we can use any function that requires a <code>MonadRNG</code> constraint with the
 <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> monad as long as the <code>RNG</code> effect is in place:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runEff . runDummyRNG $ randomString 3
</code></strong>&quot;777&quot;
</pre></div><a href="#g:5" id="g:5"><h3>Functional dependencies</h3></a><div class="doc"><p>For dealing with classes that employ functional dependencies an additional
 trick is needed.</p><p>Consider the following:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XFunctionalDependencies
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  class Monad m =&gt; MonadInput i m | m -&gt; i where
    input :: m i
:}
</pre><p>An attempt to define the instance as in the example above leads to violation
 of the liberal coverage condition:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  instance Reader i :&gt; es =&gt; MonadInput i (Eff es) where
    input = ask
:}
...
...Illegal instance declaration for &#8216;MonadInput i (Eff es)&#8217;...
...  The liberal coverage condition fails in class &#8216;MonadInput&#8217;...
...    for functional dependency: &#8216;m -&gt; i&#8217;...
...
</pre><p>However, there exists a <a href="https://www.youtube.com/watch?v=ZXtdd8e7CQQ">dirty
 trick</a> for bypassing the
 coverage condition, i.e. including the instance head in the context:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  instance (MonadInput i (Eff es), Reader i :&gt; es) =&gt; MonadInput i (Eff es) where
    input = ask
:}
</pre><p>Now the <code>MonadInput</code> class can be used with the <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> monad:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  double :: MonadInput Int m =&gt; m Int
  double = (+) &lt;$&gt; input &lt;*&gt; input
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runPureEff . runReader @Int 3 $ double
</code></strong>6
</pre></div><a href="#g:6" id="g:6"><h1>Sending operations to the handler</h1></a><div class="top"><p class="src"><a id="v:send" class="def">send</a> <a href="src/Effectful.Internal.Monad.html#send" class="link">Source</a> <a href="#v:send" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a>, e <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; e (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es) a</td><td class="doc"><p>The operation.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Send an operation of the given effect to its handler for execution.</p></div></div><a href="#g:7" id="g:7"><h1>Handling effects</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:EffectHandler" class="def">EffectHandler</a> e es <a href="src/Effectful.Internal.Monad.html#EffectHandler" class="link">Source</a> <a href="#t:EffectHandler" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&nbsp;= <span class="keyword">forall</span> a localEs. (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, e <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> localEs)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs es</td><td class="doc"><p>Capture of the local environment for handling local <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> computations
 when <code>e</code> is a higher order effect.</p></td></tr><tr><td class="src">-&gt; e (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs) a</td><td class="doc"><p>The effect performed in the local environment.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Type signature of the effect handler.</p></div></div><div class="top"><p class="src"><a id="v:interpret" class="def">interpret</a> <a href="src/Effectful.Dispatch.Dynamic.html#interpret" class="link">Source</a> <a href="#v:interpret" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a> e es</td><td class="doc"><p>The effect handler.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> (e : es) a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Interpret an effect.</p><p><em>Note:</em> <code><a href="Effectful-Dispatch-Dynamic.html#v:interpret" title="Effectful.Dispatch.Dynamic">interpret</a></code> can be turned into a <code><a href="Effectful-Dispatch-Dynamic.html#v:reinterpret" title="Effectful.Dispatch.Dynamic">reinterpret</a></code> with the use of
 <code><a href="Effectful.html#v:inject" title="Effectful">inject</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:reinterpret" class="def">reinterpret</a> <a href="src/Effectful.Dispatch.Dynamic.html#reinterpret" class="link">Source</a> <a href="#v:reinterpret" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> handlerEs a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b)</td><td class="doc"><p>Introduction of effects encapsulated within the handler.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a> e handlerEs</td><td class="doc"><p>The effect handler.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> (e : es) a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Interpret an effect using other, private effects.</p><pre><code><a href="Effectful-Dispatch-Dynamic.html#v:interpret" title="Effectful.Dispatch.Dynamic">interpret</a></code> &#8801; <code><a href="Effectful-Dispatch-Dynamic.html#v:reinterpret" title="Effectful.Dispatch.Dynamic">reinterpret</a></code> <code><a href="../base-4.18.2.0/Data-Function.html#v:id" title="Data.Function">id</a></code></pre></div></div><div class="top"><p class="src"><a id="v:interpose" class="def">interpose</a> <a href="src/Effectful.Dispatch.Dynamic.html#interpose" class="link">Source</a> <a href="#v:interpose" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <span class="keyword">forall</span> e es a. (<a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a>, e <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a> e es</td><td class="doc"><p>The effect handler.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Replace the handler of an existing effect with a new one.</p><p><em>Note:</em> this function allows for augmenting handlers with a new functionality
 as the new handler can send operations to the old one.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  data E :: Effect where
    Op :: E m ()
  type instance DispatchOf E = Dynamic
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  runE :: IOE :&gt; es =&gt; Eff (E : es) a -&gt; Eff es a
  runE = interpret $ \_ Op -&gt; liftIO (putStrLn &quot;op&quot;)
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runEff . runE $ send Op
</code></strong>op
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  augmentE :: (E :&gt; es, IOE :&gt; es) =&gt; Eff es a -&gt; Eff es a
  augmentE = interpose $ \_ Op -&gt; liftIO (putStrLn &quot;augmented op&quot;) &gt;&gt; send Op
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runEff . runE . augmentE $ send Op
</code></strong>augmented op
op
</pre></div></div><div class="top"><p class="src"><a id="v:impose" class="def">impose</a> <a href="src/Effectful.Dispatch.Dynamic.html#impose" class="link">Source</a> <a href="#v:impose" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <span class="keyword">forall</span> e es handlerEs a b. (<a href="Effectful.html#t:DispatchOf" title="Effectful">DispatchOf</a> e <a href="../base-4.18.2.0/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Effectful.html#v:Dynamic" title="Effectful">Dynamic</a>, e <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> handlerEs a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b)</td><td class="doc"><p>Introduction of effects encapsulated within the handler.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful-Dispatch-Dynamic.html#t:EffectHandler" title="Effectful.Dispatch.Dynamic">EffectHandler</a> e handlerEs</td><td class="doc"><p>The effect handler.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Replace the handler of an existing effect with a new one that uses other,
 private effects.</p><pre><code><a href="Effectful-Dispatch-Dynamic.html#v:interpose" title="Effectful.Dispatch.Dynamic">interpose</a></code> &#8801; <code><a href="Effectful-Dispatch-Dynamic.html#v:impose" title="Effectful.Dispatch.Dynamic">impose</a></code> <code><a href="../base-4.18.2.0/Data-Function.html#v:id" title="Data.Function">id</a></code></pre></div></div><a href="#g:8" id="g:8"><h2>Handling local <code>Eff</code> computations</h2></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LocalEnv" class="def">LocalEnv</a> (localEs :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>]) (handlerEs :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>]) <a href="src/Effectful.Internal.Monad.html#LocalEnv" class="link">Source</a> <a href="#t:LocalEnv" class="selflink">#</a></p><div class="doc"><p>Opaque representation of the <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> environment at the point of calling the
 <code><a href="Effectful-Dispatch-Dynamic.html#v:send" title="Effectful.Dispatch.Dynamic">send</a></code> function, i.e. right before the control is passed to the effect
 handler.</p><p>The second type variable represents effects of a handler and is needed for
 technical reasons to guarantee soundness (see
 <code><a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a></code> for more information).</p></div></div><a href="#g:9" id="g:9"><h3>Unlifts</h3></a><div class="top"><p class="src"><a id="v:localSeqUnlift" class="def">localSeqUnlift</a> <a href="src/Effectful.Dispatch.Dynamic.html#localSeqUnlift" class="link">Source</a> <a href="#v:localSeqUnlift" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a)</td><td class="doc"><p>Continuation with the unlifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a local unlifting function with the <code><a href="Effectful.html#v:SeqUnlift" title="Effectful">SeqUnlift</a></code> strategy. For the
 general version see <code><a href="Effectful-Dispatch-Dynamic.html#v:localUnlift" title="Effectful.Dispatch.Dynamic">localUnlift</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:localSeqUnliftIO" class="def">localSeqUnliftIO</a> <a href="src/Effectful.Dispatch.Dynamic.html#localSeqUnliftIO" class="link">Source</a> <a href="#v:localSeqUnliftIO" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs, <a href="Effectful.html#t:IOE" title="Effectful">IOE</a> <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> a)</td><td class="doc"><p>Continuation with the unlifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a local unlifting function with the <code><a href="Effectful.html#v:SeqUnlift" title="Effectful">SeqUnlift</a></code> strategy. For the
 general version see <code><a href="Effectful-Dispatch-Dynamic.html#v:localUnliftIO" title="Effectful.Dispatch.Dynamic">localUnliftIO</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:localUnlift" class="def">localUnlift</a> <a href="src/Effectful.Dispatch.Dynamic.html#localUnlift" class="link">Source</a> <a href="#v:localUnlift" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a)</td><td class="doc"><p>Continuation with the unlifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a local unlifting function with the given strategy.</p></div></div><div class="top"><p class="src"><a id="v:localUnliftIO" class="def">localUnliftIO</a> <a href="src/Effectful.Dispatch.Dynamic.html#localUnliftIO" class="link">Source</a> <a href="#v:localUnliftIO" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs, <a href="Effectful.html#t:IOE" title="Effectful">IOE</a> <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> a)</td><td class="doc"><p>Continuation with the unlifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a local unlifting function with the given strategy.</p></div></div><a href="#g:10" id="g:10"><h3>Lifts</h3></a><div class="top"><p class="src"><a id="v:localSeqLift" class="def">localSeqLift</a> <a href="src/Effectful.Dispatch.Dynamic.html#localSeqLift" class="link">Source</a> <a href="#v:localSeqLift" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a)</td><td class="doc"><p>Continuation with the lifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a local lifting function with the <code><a href="Effectful.html#v:SeqUnlift" title="Effectful">SeqUnlift</a></code> strategy. For the
 general version see <code><a href="Effectful-Dispatch-Dynamic.html#v:localLift" title="Effectful.Dispatch.Dynamic">localLift</a></code>.</p><p><em>Since: 2.2.1.0</em></p></div></div><div class="top"><p class="src"><a id="v:localLift" class="def">localLift</a> <a href="src/Effectful.Dispatch.Dynamic.html#localLift" class="link">Source</a> <a href="#v:localLift" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a)</td><td class="doc"><p>Continuation with the lifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a local lifting function with the given strategy.</p><p><em>Since: 2.2.1.0</em></p></div></div><div class="top"><p class="src"><a id="v:withLiftMap" class="def">withLiftMap</a> <a href="src/Effectful.Dispatch.Dynamic.html#withLiftMap" class="link">Source</a> <a href="#v:withLiftMap" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> a b. (<a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es b) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs b) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r)</td><td class="doc"><p>Continuation with the lifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Utility for lifting <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> computations of type</p><pre><code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> es a -&gt; <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> es b</pre><p>to</p><pre><code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> localEs a -&gt; <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> localEs b</pre><p><em>Note:</em> the computation must not run its argument in a different thread,
 attempting to do so will result in a runtime error.</p></div></div><div class="top"><p class="src"><a id="v:withLiftMapIO" class="def">withLiftMapIO</a> <a href="src/Effectful.Dispatch.Dynamic.html#withLiftMapIO" class="link">Source</a> <a href="#v:withLiftMapIO" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs, <a href="Effectful.html#t:IOE" title="Effectful">IOE</a> <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> a b. (<a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs a -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs b) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r)</td><td class="doc"><p>Continuation with the lifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Utility for lifting <code><a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a></code> computations of type</p><pre><code><a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a></code> a -&gt; <code><a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a></code> b</pre><p>to</p><pre><code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> localEs a -&gt; <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> localEs b</pre><p><em>Note:</em> the computation must not run its argument in a different thread,
 attempting to do so will result in a runtime error.</p><p>Useful e.g. for lifting the unmasking function in
 <code><a href="../base-4.18.2.0/Control-Exception.html#v:mask" title="Control.Exception">mask</a></code>-like computations:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>data Fork :: Effect where
  ForkWithUnmask :: ((forall a. m a -&gt; m a) -&gt; m ()) -&gt; Fork m ThreadId
type instance DispatchOf Fork = Dynamic
:}
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>runFork :: IOE :&gt; es =&gt; Eff (Fork : es) a -&gt; Eff es a
runFork = interpret $ \env (ForkWithUnmask m) -&gt; withLiftMapIO env $ \liftMap -&gt; do
  localUnliftIO env (ConcUnlift Ephemeral $ Limited 1) $ \unlift -&gt; do
    forkIOWithUnmask $ \unmask -&gt; unlift $ m $ liftMap unmask
:}
</pre></div></div><a href="#g:11" id="g:11"><h3>Bidirectional lifts</h3></a><div class="top"><p class="src"><a id="v:localLiftUnlift" class="def">localLiftUnlift</a> <a href="src/Effectful.Dispatch.Dynamic.html#localLiftUnlift" class="link">Source</a> <a href="#v:localLiftUnlift" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r) -&gt; (<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es r) -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a)</td><td class="doc"><p>Continuation with the lifting and unlifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a local lifting and unlifting function with the given strategy.</p><p>Useful for lifting complicated <code><a href="Effectful.html#t:Eff" title="Effectful">Eff</a></code> computations where the monadic action
 shows in both positive (as a result) and negative (as an argument) position.</p><p><em>Note:</em> depending on the computation you're lifting <code><a href="Effectful-Dispatch-Dynamic.html#v:localUnlift" title="Effectful.Dispatch.Dynamic">localUnlift</a></code> along with
 <code><a href="Effectful-Dispatch-Dynamic.html#v:withLiftMap" title="Effectful.Dispatch.Dynamic">withLiftMap</a></code> might be enough and is more efficient.</p></div></div><div class="top"><p class="src"><a id="v:localLiftUnliftIO" class="def">localLiftUnliftIO</a> <a href="src/Effectful.Dispatch.Dynamic.html#localLiftUnliftIO" class="link">Source</a> <a href="#v:localLiftUnliftIO" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Effectful-Dispatch-Dynamic.html#t:HasCallStack" title="Effectful.Dispatch.Dynamic">HasCallStack</a>, <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es handlerEs, <a href="Effectful.html#t:IOE" title="Effectful">IOE</a> <a href="Effectful.html#t::-62-" title="Effectful">:&gt;</a> es)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Effectful-Dispatch-Dynamic.html#t:LocalEnv" title="Effectful.Dispatch.Dynamic">LocalEnv</a> localEs handlerEs</td><td class="doc"><p>Local environment.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:UnliftStrategy" title="Effectful">UnliftStrategy</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; ((<span class="keyword">forall</span> r. <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> r -&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r) -&gt; (<span class="keyword">forall</span> r. <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> localEs r -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> r) -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> a)</td><td class="doc"><p>Continuation with the lifting and unlifting function in scope.</p></td></tr><tr><td class="src">-&gt; <a href="Effectful.html#t:Eff" title="Effectful">Eff</a> es a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a local unlifting function with the given strategy along with an
 unrestricted lifting function.</p><p>Useful for lifting complicated <code><a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a></code> computations where the monadic action
 shows in both positive (as a result) and negative (as an argument) position.</p><p><em>Note:</em> depending on the computation you're lifting <code><a href="Effectful-Dispatch-Dynamic.html#v:localUnliftIO" title="Effectful.Dispatch.Dynamic">localUnliftIO</a></code> along
 with <code><a href="Effectful-Dispatch-Dynamic.html#v:withLiftMapIO" title="Effectful.Dispatch.Dynamic">withLiftMapIO</a></code> might be enough and is more efficient.</p></div></div><a href="#g:12" id="g:12"><h3>Utils</h3></a><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:SharedSuffix" class="def">SharedSuffix</a> (es1 :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>]) (es2 :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>]) <a href="src/Effectful.Dispatch.Dynamic.html#SharedSuffix" class="link">Source</a> <a href="#t:SharedSuffix" class="selflink">#</a></p><div class="doc"><p>Require that both effect stacks share an opaque suffix.</p><p>Functions from the <code><a href="Effectful-Dispatch-Dynamic.html#v:localUnlift" title="Effectful.Dispatch.Dynamic">localUnlift</a></code> family utilize this constraint to guarantee
 sensible usage of unlifting functions.</p><p>As an example, consider the following higher order effect:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong>  data E :: Effect where
    E :: m a -&gt; E m a
  type instance DispatchOf E = Dynamic
:}
</pre><p>Running local actions in a more specific environment is fine:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> runE1 :: Eff (E ': es) a -&gt; Eff es a
 runE1 = interpret $ \env -&gt; \case
   E m -&gt; runReader () $ do
     localSeqUnlift env $ \unlift -&gt; unlift m
:}
</pre><p>Running local actions in a more general environment is fine:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> runE2 :: Eff (E ': es) a -&gt; Eff es a
 runE2 = reinterpret (runReader ()) $ \env -&gt; \case
   E m -&gt; raise $ do
     localSeqUnlift env $ \unlift -&gt; unlift m
:}
</pre><p>However, running local actions in an unrelated environment is not fine as
 this would make it possible to run anything within <code><a href="Effectful.html#v:runPureEff" title="Effectful">runPureEff</a></code>:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> runE3 :: Eff (E ': es) a -&gt; Eff es a
 runE3 = reinterpret (runReader ()) $ \env -&gt; \case
   E m -&gt; pure . runPureEff $ do
     localSeqUnlift env $ \unlift -&gt; unlift m
:}
...
...Could not deduce ...SharedSuffix '[] es...
...
</pre><p>Running local actions in a monomorphic effect stack is also not fine as
 this makes a special case of the above possible:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> runE4 :: Eff '[E, IOE] a -&gt; Eff '[IOE] a
 runE4 = interpret $ \env -&gt; \case
   E m -&gt; pure . runPureEff $ do
     localSeqUnlift env $ \unlift -&gt; unlift m
:}
...
...Running local actions in monomorphic effect stacks is not supported...
...
</pre><p><em>Since: 1.2.0.0</em></p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SharedSuffix">Instances</h4><details id="i:SharedSuffix" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:SharedSuffix:SharedSuffix:1"></span> <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es es</span> <a href="src/Effectful.Dispatch.Dynamic.html#line-791" class="link">Source</a> <a href="#t:SharedSuffix" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:SharedSuffix:SharedSuffix:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Effectful-Dispatch-Dynamic.html">Effectful.Dispatch.Dynamic</a></p></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:SharedSuffix:SharedSuffix:2"></span> <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es1 es2 =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es1 (e ': es2)</span> <a href="src/Effectful.Dispatch.Dynamic.html#line-793" class="link">Source</a> <a href="#t:SharedSuffix" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:SharedSuffix:SharedSuffix:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Effectful-Dispatch-Dynamic.html">Effectful.Dispatch.Dynamic</a></p></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:SharedSuffix:SharedSuffix:3"></span> (<a href="../base-4.18.2.0/GHC-TypeLits.html#t:TypeError" title="GHC.TypeLits">TypeError</a> ('<a href="../base-4.18.2.0/GHC-TypeLits.html#v:Text" title="GHC.TypeLits">Text</a> &quot;Running local actions in monomorphic effect stacks is not supported.&quot; '<a href="../base-4.18.2.0/GHC-TypeLits.html#v::-36--36-:" title="GHC.TypeLits">:$$:</a> '<a href="../base-4.18.2.0/GHC-TypeLits.html#v:Text" title="GHC.TypeLits">Text</a> &quot;As a solution simply change the stack to have a polymorphic suffix.&quot;) :: <a href="../base-4.18.2.0/Data-Kind.html#t:Constraint" title="Data.Kind">Constraint</a>) =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> ('[] :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>]) ('[] :: [<a href="Effectful.html#t:Effect" title="Effectful">Effect</a>])</span> <a href="src/Effectful.Dispatch.Dynamic.html#line-797" class="link">Source</a> <a href="#t:SharedSuffix" class="selflink">#</a></td><td class="doc"><p>This is always preferred to <code>SharedSuffix es es</code> as it's not incoherent.</p></td></tr><tr><td colspan="2"><details id="i:ic:SharedSuffix:SharedSuffix:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Effectful-Dispatch-Dynamic.html">Effectful.Dispatch.Dynamic</a></p></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:SharedSuffix:SharedSuffix:4"></span> <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> es1 es2 =&gt; <a href="Effectful-Dispatch-Dynamic.html#t:SharedSuffix" title="Effectful.Dispatch.Dynamic">SharedSuffix</a> (e ': es1) es2</span> <a href="src/Effectful.Dispatch.Dynamic.html#line-792" class="link">Source</a> <a href="#t:SharedSuffix" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:SharedSuffix:SharedSuffix:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Effectful-Dispatch-Dynamic.html">Effectful.Dispatch.Dynamic</a></p></details></td></tr></table></details></div></div><a href="#g:13" id="g:13"><h1>Re-exports</h1></a><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:HasCallStack" class="def">HasCallStack</a> = ?callStack :: <a href="Effectful-Error-Static.html#t:CallStack" title="Effectful.Error.Static">CallStack</a> <a href="#t:HasCallStack" class="selflink">#</a></p><div class="doc"><p>Request a CallStack.</p><p>NOTE: The implicit parameter <code>?callStack :: CallStack</code> is an
 implementation detail and <strong>should not</strong> be considered part of the
 <code><a href="Effectful-Error-Static.html#t:CallStack" title="Effectful.Error.Static">CallStack</a></code> API, we may decide to change the implementation in the
 future.</p><p><em>Since: base-4.9.0.0</em></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>