<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>RIO.File</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">rio-0.1.22.0: A standard library for Haskell</span><ul class="links" id="page-menu"><li><a href="src/RIO.File.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">RIO.File</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Regular</a></li><li><a href="#g:2">Atomic</a></li><li><a href="#g:3">Durable</a></li><li><a href="#g:4">Durable and Atomic</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><h2>Rationale</h2><p>This module offers functions to handle files that offer better durability and/or
atomicity.</p><p>See <a href="../unliftio-0.2.25.0/UnliftIO-IO-File.html">UnliftIO.IO.File</a> for the rationale behind this module, since all of the functions
were moved upstream and are now simply re-exported from here.</p><p><em>Since: 0.1.6</em></p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:withBinaryFile">withBinaryFile</a> :: <a href="../unliftio-core-0.2.1.0/Control-Monad-IO-Unlift.html#t:MonadUnliftIO" title="Control.Monad.IO.Unlift">MonadUnliftIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m a) -&gt; m a</li><li class="src short"><a href="#v:writeBinaryFile">writeBinaryFile</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="RIO-Prelude-Types.html#t:ByteString" title="RIO.Prelude.Types">ByteString</a> -&gt; m ()</li><li class="src short"><a href="#v:withBinaryFileAtomic">withBinaryFileAtomic</a> :: <a href="../unliftio-core-0.2.1.0/Control-Monad-IO-Unlift.html#t:MonadUnliftIO" title="Control.Monad.IO.Unlift">MonadUnliftIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r) -&gt; m r</li><li class="src short"><a href="#v:writeBinaryFileAtomic">writeBinaryFileAtomic</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="RIO-Prelude-Types.html#t:ByteString" title="RIO.Prelude.Types">ByteString</a> -&gt; m ()</li><li class="src short"><a href="#v:withBinaryFileDurable">withBinaryFileDurable</a> :: <a href="../unliftio-core-0.2.1.0/Control-Monad-IO-Unlift.html#t:MonadUnliftIO" title="Control.Monad.IO.Unlift">MonadUnliftIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r) -&gt; m r</li><li class="src short"><a href="#v:writeBinaryFileDurable">writeBinaryFileDurable</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="RIO-Prelude-Types.html#t:ByteString" title="RIO.Prelude.Types">ByteString</a> -&gt; m ()</li><li class="src short"><a href="#v:ensureFileDurable">ensureFileDurable</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; m ()</li><li class="src short"><a href="#v:withBinaryFileDurableAtomic">withBinaryFileDurableAtomic</a> :: <a href="../unliftio-core-0.2.1.0/Control-Monad-IO-Unlift.html#t:MonadUnliftIO" title="Control.Monad.IO.Unlift">MonadUnliftIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r) -&gt; m r</li><li class="src short"><a href="#v:writeBinaryFileDurableAtomic">writeBinaryFileDurableAtomic</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="RIO-Prelude-Types.html#t:ByteString" title="RIO.Prelude.Types">ByteString</a> -&gt; m ()</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Regular</h1></a><div class="top"><p class="src"><a id="v:withBinaryFile" class="def">withBinaryFile</a> :: <a href="../unliftio-core-0.2.1.0/Control-Monad-IO-Unlift.html#t:MonadUnliftIO" title="Control.Monad.IO.Unlift">MonadUnliftIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m a) -&gt; m a <a href="#v:withBinaryFile" class="selflink">#</a></p><div class="doc"><p>Unlifted version of <code><a href="../base-4.18.2.0/GHC-IO-StdHandles.html#v:withBinaryFile" title="GHC.IO.StdHandles">withBinaryFile</a></code>.</p><p><em>Since: unliftio-0.1.0.0</em></p></div></div><div class="top"><p class="src"><a id="v:writeBinaryFile" class="def">writeBinaryFile</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="RIO-Prelude-Types.html#t:ByteString" title="RIO.Prelude.Types">ByteString</a> -&gt; m () <a href="#v:writeBinaryFile" class="selflink">#</a></p><div class="doc"><p>Lifted version of <code><a href="../bytestring-0.11.5.3/Data-ByteString.html#v:writeFile" title="Data.ByteString">writeFile</a></code></p><p><em>Since: unliftio-0.2.12</em></p></div></div><a href="#g:2" id="g:2"><h1>Atomic</h1></a><div class="top"><p class="src"><a id="v:withBinaryFileAtomic" class="def">withBinaryFileAtomic</a> :: <a href="../unliftio-core-0.2.1.0/Control-Monad-IO-Unlift.html#t:MonadUnliftIO" title="Control.Monad.IO.Unlift">MonadUnliftIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r) -&gt; m r <a href="#v:withBinaryFileAtomic" class="selflink">#</a></p><div class="doc"><p>Perform an action on a new or existing file at the destination file path. If
 previously the file existed at the supplied file path then:</p><ul><li>in case of <code><a href="../base-4.18.2.0/System-IO.html#v:WriteMode" title="System.IO">WriteMode</a></code> it will be overwritten</li><li>upon <code><a href="../base-4.18.2.0/System-IO.html#v:ReadWriteMode" title="System.IO">ReadWriteMode</a></code> or <code><a href="../base-4.18.2.0/System-IO.html#v:AppendMode" title="System.IO">AppendMode</a></code> files contents will be copied over into a
 temporary file, thus making sure no corruption can happen to an existing file upon any
 failures, even catastrophic one, yet its contents are availble for modification.</li><li>There is nothing atomic about <code><a href="../base-4.18.2.0/System-IO.html#v:ReadMode" title="System.IO">ReadMode</a></code>, so no special treatment there.</li></ul><p>It is similar to <code><a href="RIO-File.html#v:withBinaryFileDurableAtomic" title="RIO.File">withBinaryFileDurableAtomic</a></code>, but without the durability part. It
 means that all modification can still disappear after it has been succesfully written
 due to some extreme event like an abrupt power loss, but the contents will not be
 corrupted in case when the file write did not end successfully.</p><p>The same performance caveats apply as for <code><a href="RIO-File.html#v:withBinaryFileDurableAtomic" title="RIO.File">withBinaryFileDurableAtomic</a></code> due to making a
 copy of the content of existing files during non-truncating writes.</p><p><strong>Important</strong> - Do not close the handle, otherwise it will result in <code>invalid argument
 (Bad file descriptor)</code> exception</p><p><strong>Note</strong> - on Linux operating system and only with supported file systems an anonymous
 temporary file will be used while working on the file (see <code>O_TMPFILE</code> in <code>man
 openat</code>). In case when such feature is not available or not supported a temporary file
 &quot;.target-file-nameXXX.ext.tmp&quot;, where XXX is some random number, will be created
 alongside the target file in the same directory</p><p><em>Since: unliftio-0.2.12</em></p></div></div><div class="top"><p class="src"><a id="v:writeBinaryFileAtomic" class="def">writeBinaryFileAtomic</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="RIO-Prelude-Types.html#t:ByteString" title="RIO.Prelude.Types">ByteString</a> -&gt; m () <a href="#v:writeBinaryFileAtomic" class="selflink">#</a></p><div class="doc"><p>Same as <code><a href="RIO-File.html#v:writeBinaryFileDurableAtomic" title="RIO.File">writeBinaryFileDurableAtomic</a></code>, except it does not guarantee durability.</p><h3>Cross-Platform support</h3><p>This function behaves the same as <code><a href="RIO-File.html#v:writeBinaryFile" title="RIO.File">writeBinaryFile</a></code> on Windows platforms.</p><p><em>Since: unliftio-0.2.12</em></p></div></div><a href="#g:3" id="g:3"><h1>Durable</h1></a><div class="top"><p class="src"><a id="v:withBinaryFileDurable" class="def">withBinaryFileDurable</a> :: <a href="../unliftio-core-0.2.1.0/Control-Monad-IO-Unlift.html#t:MonadUnliftIO" title="Control.Monad.IO.Unlift">MonadUnliftIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r) -&gt; m r <a href="#v:withBinaryFileDurable" class="selflink">#</a></p><div class="doc"><p>Opens a file with the following guarantees:</p><ul><li>It successfully closes the file in case of an asynchronous exception</li><li>It reliably saves the file in the correct directory; including edge case situations
   like a different device being mounted to the current directory, or the current
   directory being renamed to some other name while the file is being used.</li><li>It ensures durability by executing an <code>fsync()</code> call before closing the file handle</li></ul><h3>Cross-Platform support</h3><p>This function behaves the same as <code><a href="../base-4.18.2.0/System-IO.html#v:withBinaryFile" title="System.IO">withBinaryFile</a></code> on Windows platforms.</p><p><em>Since: unliftio-0.2.12</em></p></div></div><div class="top"><p class="src"><a id="v:writeBinaryFileDurable" class="def">writeBinaryFileDurable</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="RIO-Prelude-Types.html#t:ByteString" title="RIO.Prelude.Types">ByteString</a> -&gt; m () <a href="#v:writeBinaryFileDurable" class="selflink">#</a></p><div class="doc"><p>Similar to <code><a href="RIO-File.html#v:writeBinaryFile" title="RIO.File">writeBinaryFile</a></code>, but it also ensures that changes executed to the file
 are guaranteed to be durable. It internally uses <code>fsync()</code> and makes sure it
 synchronizes the file on disk.</p><h3>Cross-Platform support</h3><p>This function behaves the same as <code><a href="RIO.html#v:writeBinaryFile" title="RIO">writeBinaryFile</a></code> on Windows platforms.</p><p><em>Since: unliftio-0.2.12</em></p></div></div><div class="top"><p class="src"><a id="v:ensureFileDurable" class="def">ensureFileDurable</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; m () <a href="#v:ensureFileDurable" class="selflink">#</a></p><div class="doc"><p>After a file is closed, this function opens it again and executes <code>fsync()</code>
 internally on both the file and the directory that contains it. Note that this function
 is intended to work around the non-durability of existing file APIs, as opposed to
 being necessary for the API functions provided in this module.</p><p><a href="https://stackoverflow.com/questions/37288453/calling-fsync2-after-close2/50158433#50158433">The effectiveness of calling this function is
 debatable</a>,
 as it relies on internal implementation details at the Kernel level that might
 change. We argue that, despite this fact, calling this function may bring benefits in
 terms of durability.</p><p>This function does not provide the same guarantee as if you would open and modify a
 file using <code><a href="RIO-File.html#v:withBinaryFileDurable" title="RIO.File">withBinaryFileDurable</a></code> or <code><a href="RIO-File.html#v:writeBinaryFileDurable" title="RIO.File">writeBinaryFileDurable</a></code>, since they ensure that
 the <code>fsync()</code> is called before the file is closed, so if possible use those instead.</p><h3>Cross-Platform support</h3><p>This function is a noop on Windows platforms.</p><p><em>Since: unliftio-0.2.12</em></p></div></div><a href="#g:4" id="g:4"><h1>Durable and Atomic</h1></a><div class="top"><p class="src"><a id="v:withBinaryFileDurableAtomic" class="def">withBinaryFileDurableAtomic</a> :: <a href="../unliftio-core-0.2.1.0/Control-Monad-IO-Unlift.html#t:MonadUnliftIO" title="Control.Monad.IO.Unlift">MonadUnliftIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r) -&gt; m r <a href="#v:withBinaryFileDurableAtomic" class="selflink">#</a></p><div class="doc"><p>Opens a file with the following guarantees:</p><ul><li>It successfully closes the file in case of an asynchronous exception</li><li>It reliably saves the file in the correct directory; including edge case situations
   like a different device being mounted to the current directory, or the current
   directory being renamed to some other name while the file is being used.</li><li>It ensures durability by executing an <code>fsync()</code> call before closing the file handle</li><li>It keeps all changes in a temporary file, and after it is closed it atomically moves
   the temporary file to the original filepath, in case of catastrophic failure, the
   original file stays unaffected.</li></ul><p>If you do not need durability but only atomicity, use <code><a href="RIO-File.html#v:withBinaryFileAtomic" title="RIO.File">withBinaryFileAtomic</a></code> instead,
 which is faster as it does not perform <code>fsync()</code>.</p><p><strong>Important</strong> - Make sure not to close the <code><a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a></code>, it will be closed for you,
 otherwise it will result in <code>invalid argument (Bad file descriptor)</code> exception.</p><h3>Performance Considerations</h3><p>When using a writable but non-truncating <code><a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a></code> (i.e. <code><a href="../base-4.18.2.0/System-IO.html#v:ReadWriteMode" title="System.IO">ReadWriteMode</a></code> and
 <code><a href="../base-4.18.2.0/System-IO.html#v:AppendMode" title="System.IO">AppendMode</a></code>), this function performs a copy operation of the specified input file to
 guarantee the original file is intact in case of a catastrophic failure (no partial
 writes). This approach may be prohibitive in scenarios where the input file is expected
 to be large in size.</p><h3>Cross-Platform support</h3><p>This function behaves the same as <code><a href="../base-4.18.2.0/System-IO.html#v:withBinaryFile" title="System.IO">withBinaryFile</a></code> on Windows platforms.</p><p><em>Since: unliftio-0.2.12</em></p></div></div><div class="top"><p class="src"><a id="v:writeBinaryFileDurableAtomic" class="def">writeBinaryFileDurableAtomic</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="RIO-FilePath.html#t:FilePath" title="RIO.FilePath">FilePath</a> -&gt; <a href="RIO-Prelude-Types.html#t:ByteString" title="RIO.Prelude.Types">ByteString</a> -&gt; m () <a href="#v:writeBinaryFileDurableAtomic" class="selflink">#</a></p><div class="doc"><p>Similar to <code><a href="RIO-File.html#v:writeBinaryFile" title="RIO.File">writeBinaryFile</a></code>, but it also guarantes that changes executed to the file
 are durable, also, in case of failure, the modified file is never going to get
 corrupted. It internally uses <code>fsync()</code> and makes sure it synchronizes the file on
 disk.</p><h3>Cross-Platform support</h3><p>This function behaves the same as <code><a href="RIO-File.html#v:writeBinaryFile" title="RIO.File">writeBinaryFile</a></code> on Windows platforms.</p><p><em>Since: unliftio-0.2.12</em></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>