<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Wuss</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">wuss-2.0.1.7: Secure WebSocket (WSS) clients</span><ul class="links" id="page-menu"><li><a href="src/Wuss.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Wuss</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Wuss is a library that lets you easily create secure WebSocket clients over
    the WSS protocol. It is a small addition to
    <a href="https://hackage.haskell.org/package/websockets">the websockets package</a>
    and is adapted from existing solutions by
    <a href="https://gist.github.com/jaspervdj/7198388">@jaspervdj</a>,
    <a href="https://gist.github.com/mpickering/f1b7ba3190a4bb5884f3">@mpickering</a>, and
    <a href="https://gist.github.com/elfenlaid/7b5c28065e67e4cf0767">@elfenlaid</a>.</p><h2>Example</h2><pre>import Wuss

import Control.Concurrent (forkIO)
import Control.Monad (forever, unless, void)
import Data.Text (Text, pack)
import Network.WebSockets (ClientApp, receiveData, sendClose, sendTextData)

main :: IO ()
main = runSecureClient &quot;echo.websocket.org&quot; 443 &quot;/&quot; ws

ws :: ClientApp ()
ws connection = do
    putStrLn &quot;Connected!&quot;

    void . forkIO . forever $ do
        message &lt;- receiveData connection
        print (message :: Text)

    let loop = do
            line &lt;- getLine
            unless (null line) $ do
                sendTextData connection (pack line)
                loop
    loop

    sendClose connection (pack &quot;Bye!&quot;)</pre><h2>Retry</h2><p>Note that it is possible for the connection itself or any message to fail and need to be retried.
    Fortunately this can be handled by something like <a href="https://hackage.haskell.org/package/retry">the retry package</a>.
    See <a href="https://github.com/tfausak/wuss/issues/18#issuecomment-990921703">this comment</a> for an example.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:runSecureClient">runSecureClient</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m =&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:HostName" title="Network.Socket">HostName</a> -&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:PortNumber" title="Network.Socket">PortNumber</a> -&gt; <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Client.html#t:ClientApp" title="Network.WebSockets.Client">ClientApp</a> a -&gt; m a</li><li class="src short"><a href="#v:runSecureClientWith">runSecureClientWith</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m =&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:HostName" title="Network.Socket">HostName</a> -&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:PortNumber" title="Network.Socket">PortNumber</a> -&gt; <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Connection.html#t:ConnectionOptions" title="Network.WebSockets.Connection">ConnectionOptions</a> -&gt; <a href="../websockets-0.12.7.3/Network-WebSockets.html#t:Headers" title="Network.WebSockets">Headers</a> -&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Client.html#t:ClientApp" title="Network.WebSockets.Client">ClientApp</a> a -&gt; m a</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:Config">Config</a> = <a href="#v:Config">Config</a> {<ul class="subs"><li><a href="#v:connectionGet">connectionGet</a> :: <a href="../crypton-connection-0.3.2/Network-Connection.html#t:Connection" title="Network.Connection">Connection</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li></ul>}</li><li class="src short"><a href="#v:defaultConfig">defaultConfig</a> :: <a href="Wuss.html#t:Config" title="Wuss">Config</a></li><li class="src short"><a href="#v:runSecureClientWithConfig">runSecureClientWithConfig</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m =&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:HostName" title="Network.Socket">HostName</a> -&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:PortNumber" title="Network.Socket">PortNumber</a> -&gt; <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="Wuss.html#t:Config" title="Wuss">Config</a> -&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Connection.html#t:ConnectionOptions" title="Network.WebSockets.Connection">ConnectionOptions</a> -&gt; <a href="../websockets-0.12.7.3/Network-WebSockets.html#t:Headers" title="Network.WebSockets">Headers</a> -&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Client.html#t:ClientApp" title="Network.WebSockets.Client">ClientApp</a> a -&gt; m a</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:runSecureClient" class="def">runSecureClient</a> <a href="src/Wuss.html#runSecureClient" class="link">Source</a> <a href="#v:runSecureClient" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:HostName" title="Network.Socket">HostName</a></td><td class="doc"><p>Host</p></td></tr><tr><td class="src">-&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:PortNumber" title="Network.Socket">PortNumber</a></td><td class="doc"><p>Port</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>Path</p></td></tr><tr><td class="src">-&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Client.html#t:ClientApp" title="Network.WebSockets.Client">ClientApp</a> a</td><td class="doc"><p>Application</p></td></tr><tr><td class="src">-&gt; m a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>A secure replacement for <code><a href="../websockets-0.12.7.3/Network-WebSockets.html#v:runClient" title="Network.WebSockets">runClient</a></code>.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let app _connection = return ()
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runSecureClient &quot;echo.websocket.org&quot; 443 &quot;/&quot; app
</code></strong></pre></div></div><div class="top"><p class="src"><a id="v:runSecureClientWith" class="def">runSecureClientWith</a> <a href="src/Wuss.html#runSecureClientWith" class="link">Source</a> <a href="#v:runSecureClientWith" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:HostName" title="Network.Socket">HostName</a></td><td class="doc"><p>Host</p></td></tr><tr><td class="src">-&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:PortNumber" title="Network.Socket">PortNumber</a></td><td class="doc"><p>Port</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>Path</p></td></tr><tr><td class="src">-&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Connection.html#t:ConnectionOptions" title="Network.WebSockets.Connection">ConnectionOptions</a></td><td class="doc"><p>Options</p></td></tr><tr><td class="src">-&gt; <a href="../websockets-0.12.7.3/Network-WebSockets.html#t:Headers" title="Network.WebSockets">Headers</a></td><td class="doc"><p>Headers</p></td></tr><tr><td class="src">-&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Client.html#t:ClientApp" title="Network.WebSockets.Client">ClientApp</a> a</td><td class="doc"><p>Application</p></td></tr><tr><td class="src">-&gt; m a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>A secure replacement for <code><a href="../websockets-0.12.7.3/Network-WebSockets.html#v:runClientWith" title="Network.WebSockets">runClientWith</a></code>.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let options = defaultConnectionOptions
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let headers = []
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let app _connection = return ()
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runSecureClientWith &quot;echo.websocket.org&quot; 443 &quot;/&quot; options headers app
</code></strong></pre><p>If you want to run a secure client without certificate validation, use
    <code><a href="../websockets-0.12.7.3/Network-WebSockets.html#v:runClientWithStream" title="Network.WebSockets">runClientWithStream</a></code>. For example:</p><pre>let host = &quot;echo.websocket.org&quot;
let port = 443
let path = &quot;/&quot;
let options = defaultConnectionOptions
let headers = []
let tlsSettings = TLSSettingsSimple
    -- This is the important setting.
    { settingDisableCertificateValidation = True
    , settingDisableSession = False
    , settingUseServerName = False
    }
let connectionParams = ConnectionParams
    { connectionHostname = host
    , connectionPort = port
    , connectionUseSecure = Just tlsSettings
    , connectionUseSocks = Nothing
    }

context &lt;- initConnectionContext
connection &lt;- connectTo context connectionParams
stream &lt;- makeStream
    (fmap Just (connectionGetChunk connection))
    (maybe (return ()) (connectionPut connection . toStrict))
runClientWithStream stream host path options headers $ \ connection -&gt; do
    -- Do something with the connection.
    return ()</pre></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:Config" class="def">Config</a> <a href="src/Wuss.html#Config" class="link">Source</a> <a href="#t:Config" class="selflink">#</a></p><div class="doc"><p>Configures a secure WebSocket connection.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Config" class="def">Config</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:connectionGet" class="def">connectionGet</a> :: <a href="../crypton-connection-0.3.2/Network-Connection.html#t:Connection" title="Network.Connection">Connection</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../bytestring-0.11.5.3/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></dfn><div class="doc"><p>How to get bytes from the connection. Typically
 <code><a href="../crypton-connection-0.3.2/Network-Connection.html#v:connectionGetChunk" title="Network.Connection">connectionGetChunk</a></code>, but could be something else like
 <code><a href="../crypton-connection-0.3.2/Network-Connection.html#v:connectionGetLine" title="Network.Connection">connectionGetLine</a></code>.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:defaultConfig" class="def">defaultConfig</a> :: <a href="Wuss.html#t:Config" title="Wuss">Config</a> <a href="src/Wuss.html#defaultConfig" class="link">Source</a> <a href="#v:defaultConfig" class="selflink">#</a></p><div class="doc"><p>The default <code><a href="Wuss.html#t:Config" title="Wuss">Config</a></code> value used by <code><a href="Wuss.html#v:runSecureClientWith" title="Wuss">runSecureClientWith</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:runSecureClientWithConfig" class="def">runSecureClientWithConfig</a> <a href="src/Wuss.html#runSecureClientWithConfig" class="link">Source</a> <a href="#v:runSecureClientWithConfig" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:HostName" title="Network.Socket">HostName</a></td><td class="doc"><p>Host</p></td></tr><tr><td class="src">-&gt; <a href="../network-3.1.4.0/Network-Socket.html#t:PortNumber" title="Network.Socket">PortNumber</a></td><td class="doc"><p>Port</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>Path</p></td></tr><tr><td class="src">-&gt; <a href="Wuss.html#t:Config" title="Wuss">Config</a></td><td class="doc"><p>Config</p></td></tr><tr><td class="src">-&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Connection.html#t:ConnectionOptions" title="Network.WebSockets.Connection">ConnectionOptions</a></td><td class="doc"><p>Options</p></td></tr><tr><td class="src">-&gt; <a href="../websockets-0.12.7.3/Network-WebSockets.html#t:Headers" title="Network.WebSockets">Headers</a></td><td class="doc"><p>Headers</p></td></tr><tr><td class="src">-&gt; <a href="../websockets-0.12.7.3/Network-WebSockets-Client.html#t:ClientApp" title="Network.WebSockets.Client">ClientApp</a> a</td><td class="doc"><p>Application</p></td></tr><tr><td class="src">-&gt; m a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Runs a secure WebSockets client with the given <code><a href="Wuss.html#t:Config" title="Wuss">Config</a></code>.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>